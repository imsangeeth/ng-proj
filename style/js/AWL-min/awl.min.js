/*
* Copyright (c) 2017 Avaya Inc. All rights reserved.
*/ 
var CryptoJS=CryptoJS||function(A,d){var f={},h=f.lib={},e=function(){},b=h.Base={extend:function(a){e.prototype=this;var g=new e;a&&g.mixIn(a);g.hasOwnProperty("init")||(g.init=function(){g.$super.init.apply(this,arguments)});g.init.prototype=g;g.$super=this;return g},create:function(){var a=this.extend();a.init.apply(a,arguments);return a},init:function(){},mixIn:function(a){for(var g in a){a.hasOwnProperty(g)&&(this[g]=a[g])}a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},c=h.WordArray=b.extend({init:function(a,g){a=this.words=a||[];this.sigBytes=g!=d?g:4*a.length},toString:function(a){return(a||z).stringify(this)},concat:function(k){var n=this.words,l=k.words,m=this.sigBytes;k=k.sigBytes;this.clamp();if(m%4){for(var p=0;p<k;p++){n[m+p>>>2]|=(l[p>>>2]>>>24-8*(p%4)&255)<<24-8*((m+p)%4)}}else{if(65535<l.length){for(p=0;p<k;p+=4){n[m+p>>>2]=l[p>>>2]}}else{n.push.apply(n,l)}}this.sigBytes+=k;return this},clamp:function(){var a=this.words,g=this.sigBytes;a[g>>>2]&=4294967295<<32-8*(g%4);a.length=A.ceil(g/4)},clone:function(){var a=b.clone.call(this);a.words=this.words.slice(0);return a},random:function(g){for(var l=[],k=0;k<g;k+=4){l.push(4294967296*A.random()|0)}return new c.init(l,g)}}),x=f.enc={},z=x.Hex={stringify:function(l){var m=l.words;l=l.sigBytes;for(var q=[],p=0;p<l;p++){var n=m[p>>>2]>>>24-8*(p%4)&255;q.push((n>>>4).toString(16));q.push((n&15).toString(16))}return q.join("")},parse:function(k){for(var l=k.length,n=[],m=0;m<l;m+=2){n[m>>>3]|=parseInt(k.substr(m,2),16)<<24-4*(m%8)}return new c.init(n,l/2)}},w=x.Latin1={stringify:function(k){var l=k.words;k=k.sigBytes;for(var n=[],m=0;m<k;m++){n.push(String.fromCharCode(l[m>>>2]>>>24-8*(m%4)&255))}return n.join("")},parse:function(k){for(var l=k.length,n=[],m=0;m<l;m++){n[m>>>2]|=(k.charCodeAt(m)&255)<<24-8*(m%4)}return new c.init(n,l)}},y=x.Utf8={stringify:function(a){try{return decodeURIComponent(escape(w.stringify(a)))}catch(k){throw Error("Malformed UTF-8 data")}},parse:function(a){return w.parse(unescape(encodeURIComponent(a)))}},o=h.BufferedBlockAlgorithm=b.extend({reset:function(){this._data=new c.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=y.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(p){var r=this._data,u=r.words,t=r.sigBytes,s=this.blockSize,n=t/(4*s),n=p?A.ceil(n):A.max((n|0)-this._minBufferSize,0);p=n*s;t=A.min(4*p,t);if(p){for(var q=0;q<p;q+=s){this._doProcessBlock(u,q)}q=u.splice(0,p);r.sigBytes-=t}return new c.init(q,t)},clone:function(){var a=b.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});h.Hasher=o.extend({cfg:b.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){o.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(k,l){return(new a.init(l)).finalize(k)}},_createHmacHelper:function(a){return function(k,l){return(new j.HMAC.init(a,l)).finalize(k)}}});var j=f.algo={};return f}(Math);(function(w){function d(r,s,p,u,q,t,n){r=r+(s&p|~s&u)+q+n;return(r<<t|r>>>32-t)+s}function f(r,s,p,u,q,t,n){r=r+(s&u|p&~u)+q+n;return(r<<t|r>>>32-t)+s}function g(r,s,p,u,q,t,n){r=r+(s^p^u)+q+n;return(r<<t|r>>>32-t)+s}function e(r,s,p,u,q,t,n){r=r+(p^(s|~u))+q+n;return(r<<t|r>>>32-t)+s}for(var b=CryptoJS,c=b.lib,j=c.WordArray,o=c.Hasher,c=b.algo,h=[],k=0;64>k;k++){h[k]=4294967296*w.abs(w.sin(k+1))|0}c=c.MD5=o.extend({_doReset:function(){this._hash=new j.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(Q,N){for(var V=0;16>V;V++){var P=N+V,n=Q[P];Q[P]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360}var V=this._hash.words,P=Q[N+0],n=Q[N+1],O=Q[N+2],L=Q[N+3],J=Q[N+4],H=Q[N+5],F=Q[N+6],E=Q[N+7],p=Q[N+8],m=Q[N+9],l=Q[N+10],a=Q[N+11],M=Q[N+12],K=Q[N+13],I=Q[N+14],G=Q[N+15],U=V[0],T=V[1],S=V[2],R=V[3],U=d(U,T,S,R,P,7,h[0]),R=d(R,U,T,S,n,12,h[1]),S=d(S,R,U,T,O,17,h[2]),T=d(T,S,R,U,L,22,h[3]),U=d(U,T,S,R,J,7,h[4]),R=d(R,U,T,S,H,12,h[5]),S=d(S,R,U,T,F,17,h[6]),T=d(T,S,R,U,E,22,h[7]),U=d(U,T,S,R,p,7,h[8]),R=d(R,U,T,S,m,12,h[9]),S=d(S,R,U,T,l,17,h[10]),T=d(T,S,R,U,a,22,h[11]),U=d(U,T,S,R,M,7,h[12]),R=d(R,U,T,S,K,12,h[13]),S=d(S,R,U,T,I,17,h[14]),T=d(T,S,R,U,G,22,h[15]),U=f(U,T,S,R,n,5,h[16]),R=f(R,U,T,S,F,9,h[17]),S=f(S,R,U,T,a,14,h[18]),T=f(T,S,R,U,P,20,h[19]),U=f(U,T,S,R,H,5,h[20]),R=f(R,U,T,S,l,9,h[21]),S=f(S,R,U,T,G,14,h[22]),T=f(T,S,R,U,J,20,h[23]),U=f(U,T,S,R,m,5,h[24]),R=f(R,U,T,S,I,9,h[25]),S=f(S,R,U,T,L,14,h[26]),T=f(T,S,R,U,p,20,h[27]),U=f(U,T,S,R,K,5,h[28]),R=f(R,U,T,S,O,9,h[29]),S=f(S,R,U,T,E,14,h[30]),T=f(T,S,R,U,M,20,h[31]),U=g(U,T,S,R,H,4,h[32]),R=g(R,U,T,S,p,11,h[33]),S=g(S,R,U,T,a,16,h[34]),T=g(T,S,R,U,I,23,h[35]),U=g(U,T,S,R,n,4,h[36]),R=g(R,U,T,S,J,11,h[37]),S=g(S,R,U,T,E,16,h[38]),T=g(T,S,R,U,l,23,h[39]),U=g(U,T,S,R,K,4,h[40]),R=g(R,U,T,S,P,11,h[41]),S=g(S,R,U,T,L,16,h[42]),T=g(T,S,R,U,F,23,h[43]),U=g(U,T,S,R,m,4,h[44]),R=g(R,U,T,S,M,11,h[45]),S=g(S,R,U,T,G,16,h[46]),T=g(T,S,R,U,O,23,h[47]),U=e(U,T,S,R,P,6,h[48]),R=e(R,U,T,S,E,10,h[49]),S=e(S,R,U,T,I,15,h[50]),T=e(T,S,R,U,H,21,h[51]),U=e(U,T,S,R,M,6,h[52]),R=e(R,U,T,S,L,10,h[53]),S=e(S,R,U,T,l,15,h[54]),T=e(T,S,R,U,n,21,h[55]),U=e(U,T,S,R,p,6,h[56]),R=e(R,U,T,S,G,10,h[57]),S=e(S,R,U,T,F,15,h[58]),T=e(T,S,R,U,K,21,h[59]),U=e(U,T,S,R,J,6,h[60]),R=e(R,U,T,S,a,10,h[61]),S=e(S,R,U,T,O,15,h[62]),T=e(T,S,R,U,m,21,h[63]);V[0]=V[0]+U|0;V[1]=V[1]+T|0;V[2]=V[2]+S|0;V[3]=V[3]+R|0},_doFinalize:function(){var p=this._data,q=p.words,m=8*this._nDataBytes,r=8*p.sigBytes;q[r>>>5]|=128<<24-r%32;var n=w.floor(m/4294967296);q[(r+64>>>9<<4)+15]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360;q[(r+64>>>9<<4)+14]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360;p.sigBytes=4*(q.length+1);this._process();p=this._hash;q=p.words;for(m=0;4>m;m++){r=q[m],q[m]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360}return p},clone:function(){var l=o.clone.call(this);l._hash=this._hash.clone();return l}});b.MD5=o._createHelper(c);b.HmacMD5=o._createHmacHelper(c)})(Math);(function(){var a=a||{};window.AWL=a;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d){if(this==null){throw new TypeError()}var e=Object(this);var b=e.length>>>0;if(b===0){return -1}var f=0;if(arguments.length>1){f=Number(arguments[1]);if(f!=f){f=0}else{if(f!=0&&f!=Infinity&&f!=-Infinity){f=(f>0||-1)*Math.floor(Math.abs(f))}}}if(f>=b){return -1}var c=f>=0?f:Math.max(b-Math.abs(f),0);for(;c<b;c++){if(c in e&&e[c]===d){return c}}return -1}}a.namespace=function(e){var d=e.split("."),c=a,b;if(d[0]==="AWL"){d=d.slice(1)}for(b=0;b<d.length;b+=1){if(typeof c[d[b]]==="undefined"){c[d[b]]={}}c=c[d[b]]}return c};a.namespace("utilities.env");a.utilities.env=(function(){var c=(function(){if(window.WebSocket){return window.WebSocket}else{if(window.MozWebSocket){return window.MozWebSocket}else{return null}}}());var d=(function(){return !!document.createElement("canvas").getContext}());var b=window.URL||window.webkitURL;return{WebSocket:c,canvasExists:d,URL:b}}());a.utilities.url=(function(){return{getURLParameter:function b(d){return decodeURIComponent((new RegExp("[?|&]"+d+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},removeUrlParamter:function c(g,f){var e=g.indexOf(f);var d=g.indexOf("&",e);if(d==-1){d=g.length}var h=g.substring(0,e)+g.substring(d,g.length);if(h.charAt(h.length-1)==="?"){h=h.substring(0,h.length-1)}return h}}}());a.utilities.cookie=(function(){function d(g,h,j){if(j){var f=new Date();f.setTime(f.getTime()+(j*24*60*60*1000));var e="; expires="+f.toGMTString()}else{var e=""}document.cookie=g+"="+h+e+"; path=/"}function b(f){var h=f+"=";var e=document.cookie.split(";");for(var g=0;g<e.length;g++){var j=e[g];while(j.charAt(0)==" "){j=j.substring(1,j.length)}if(j.indexOf(h)==0){return j.substring(h.length,j.length)}}return null}function c(e){d(e,"",-1)}return{set:d,get:b,erase:c}}());a.utilities.date=(function(){var c=function(h,g){var e=null;var d=false;if(!g){g=new Date()}if(h==="12"){e=g.getHours();if(e>=12){e=e-12;d=true}else{if(e===0){e=12}}}else{e=g.getHours()}var f=""+e+":"+g.getMinutes();if(h==="12"){if(d){f=f+" pm"}else{f=f+" am"}}return f};var b=function(f){var e=true;if(!f){f=new Date()}else{var d=new Date().toDateString();if(d!==f.toDateString()){e=false}}if(e){return"Today"}else{return f.toLocaleDateString()}};return{getFormatedTime:c,getFormatedDate:b}}());a.namespace("notification");a.notification=(function(){var d=function(h){var f=document.title;var g=setInterval(function(){document.title=document.title==h?f:h},1000);window.onmousemove=function(){clearInterval(g);document.title=f;window.onmousemove=null}};var e=(function(){if(window.webkitNotifications){return function(h,j,f){if(window.webkitNotifications.checkPermission()==0){var g=window.webkitNotifications.createNotification(h,j,f);g.show();return g}else{return null}}}else{return function(){return null}}}());var c=(function(){if(window.webkitNotifications){return function(f){if(window.webkitNotifications.checkPermission()==0){var g=window.webkitNotifications.createHTMLNotification(f);g.show();return g}else{return null}}}else{return function(){return null}}}());var b=function(){if(window.webkitNotifications){window.webkitNotifications.requestPermission()}};return{titleAlert:d,notify:e,notifyHtml:c,requestPermission:b}}());a.namespace("console");a.namespace("sdkLog");a.sdkLog=(function(){var e={};var b={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},dir:function(){}};e.enableLogging=function d(){a.console=console};e.disableLogging=function c(){a.console=b};return e}());a.namespace("clientAPIConsole");a.namespace("clientLog");a.clientLog=(function(){var e={};var b={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},dir:function(){}};e.enableLogging=function d(){a.clientAPIConsole=console};e.disableLogging=function c(){a.clientAPIConsole=b};return e}());a.namespace("Event");a.Event=(function(){var b=function(c){this._source=c;this._listeners=[]};b.prototype.attach=function(c){this._listeners.push(c)};b.prototype.detachAll=function(){this._listeners=[]};b.prototype.detach=function(d){var c=this._listeners.indexOf(d);if(c!=-1){this._listeners.splice(c,1)}};b.prototype.notify=function(d){var f=null;for(var e=0,c=this._listeners.length;e<c;e+=1){f=this._listeners[e];if(typeof f==="function"){f(this._source,d)}}};return b}());a.namespace("callBack");a.callBack=(function(){var b=function(){this._listeners=[]};b.prototype.attach=function(c){this._listeners.push(c)};b.prototype.detachAll=function(){this._listeners=[]};b.prototype.detach=function(d){var c=this._listeners.indexOf(d);if(c!=-1){this._listeners.splice(c,1)}};b.prototype.notify=function(f,d,c){var h=null;for(var g=0,e=this._listeners.length;g<e;g+=1){h=this._listeners[g];if(typeof h==="function"){if((typeof(d)==="undefined")&&(typeof(c)==="undefined")){h(f)}else{if(typeof(c)==="undefined"){h(f,d)}else{h(f,d,c)}}}}};return b}());(function(){if(typeof window==="object"){if(window.HTMLMediaElement&&!("srcObject" in window.HTMLMediaElement.prototype)){Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject" in this?this.mozSrcObject:this._srcObject},set:function(b){if("mozSrcObject" in this){this.mozSrcObject=b}else{this._srcObject=b;if(webkitURLSupported()){this.src=webkitURL.createObjectURL(b)}else{this.src=URL.createObjectURL(b)}}}})}}}());a.namespace("jsonRpc");a.jsonRpc=null;a.namespace("wsConnection");a.wsConnection=null;a.namespace("localStream");a.namespace("remoteStream");a.namespace("videoTracks");a.namespace("serviceType");a.namespace("callMap");a.namespace("remVideo");a.namespace("onConfigChange");a.namespace("onRegistrationStateChange");a.namespace("onCallStateChange");a.namespace("onNewIncomingCall");a.namespace("onCallTerminate");a.namespace("onMakeCallObj");a.namespace("totalCalls");a.namespace("muteAllStreams");a.namespace("videoPaused");a.namespace("inUse_Version");a.namespace("dtmfPayLoadType");a.dtmfPayLoadType="101"}());function onconfigStateChange(a){}function onRegistrationStateChange(a){}function onCallListener(){}function webkitURLSupported(){var c=navigator.userAgent.indexOf("Chrome/");var b=navigator.userAgent.indexOf(".",c);var a=parseInt(navigator.userAgent.substring(c+7,b));AWL.console.debug("Chrome version: "+a);if(a<47){return true}return false}AWL.namespace("io.jsonRpc.utils");AWL.io.jsonRpc.utils=(function(){var a=function(){var c=this;var b={MSGTYPE:{CLIENTREQ:{DEFAULT:"GeneralResponse",LOGIN:"loginResponse",LOGOUT:"logoutResponse",MAKECALL:"makeCallResponse",TRANSFERCALL:"transferCallResponse",ANSWERCALL:"answerCallResponse",REJECTCALL:"rejectCallResponse",ABORTCALL:"abortCallResponse",ENDCALL:"endCallResponse",HOLDCALL:"holdCallResponse",UNHOLDCALL:"unholdCallResponse",UPDATEMEDIA:"updateMediaResponse",ACCEPTMEDIAUPDATEREQUEST:"acceptMediaUpdateResponse",REJECTMEDIAUPDATEREQUEST:"rejectMediaUpdateResponse",ANSWEREARLYMEDIA:"answerEarlyMediaResponse",GETGATEWAYSETTINGS:"gatewaySettingsResponse"}},EVENT:{INCOMINGCALL:"IncomingCall",CALLPROGRESS:"CallProgressing",CALLCONNECTED:"CallConnected",CALLFAILED:"CallFailed",CALLDISCONNECTED:"CallDisconnected",CALLHELD:"CallHeld",CALLUNHELD:"CallUnheld",CALLCONTROLCTI:"CallCtiEventReceived",LOGINSTATUSCHANGED:"LoginStatusChanged",TRANSFERCOMPLETE:"CallTransferSuccessful",TRANSFERFAILURE:"CallTransferFailed",FARENDCHANGED:"FarEndChanged",MEDIAUPDATEREQUEST:"MediaUpdateRequest",GATEWAYSETTINGSCHANGED:"GatewaySettingsChanged"},JSON_DEFAULT_FIELDVALUE:{PROTOCOL:"jsonrpc-2.0.0",SERVICE:"phoneservice"}};this.getMessageId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var e=Math.random()*16|0,d=f=="x"?e:(e&3|8);return d.toString(16)})};this.isValidMsgStruct=function(d){if((typeof(d.protocol)==="undefined")||(typeof(d.id)==="undefined")||(typeof(d.service)==="undefined")||(typeof(d.msgname)==="undefined")||(typeof(d.params)==="undefined")){AWL.console.error("Missing mandate Json Rpc message structure");return false}if((d.protocol!==b.JSON_DEFAULT_FIELDVALUE.PROTOCOL)||(d.id===null)||(d.service==="")||(d.msgname==="")||(d.params==="")){AWL.console.error("Incorrect Json Rpc message field value");return false}return true};this.findMatchingResp=function(d){switch(d){case"login":return b.MSGTYPE.CLIENTREQ.LOGIN;case"logout":return b.MSGTYPE.CLIENTREQ.LOGOUT;case"makeCall":return b.MSGTYPE.CLIENTREQ.MAKECALL;case"transferCall":return b.MSGTYPE.CLIENTREQ.TRANSFERCALL;case"answerCall":return b.MSGTYPE.CLIENTREQ.ANSWERCALL;case"rejectCall":return b.MSGTYPE.CLIENTREQ.REJECTCALL;case"abortCall":return b.MSGTYPE.CLIENTREQ.ABORTCALL;case"endCall":return b.MSGTYPE.CLIENTREQ.ENDCALL;case"holdCall":return b.MSGTYPE.CLIENTREQ.HOLDCALL;case"unholdCall":return b.MSGTYPE.CLIENTREQ.UNHOLDCALL;case"updateMedia":return b.MSGTYPE.CLIENTREQ.UPDATEMEDIA;case"acceptMediaUpdateRequest":return b.MSGTYPE.CLIENTREQ.ACCEPTMEDIAUPDATEREQUEST;case"rejectMediaUpdateRequest":return b.MSGTYPE.CLIENTREQ.REJECTMEDIAUPDATEREQUEST;case"answerEarlyMedia":return b.MSGTYPE.CLIENTREQ.ANSWEREARLYMEDIA;case"getGatewaySettings":return b.MSGTYPE.CLIENTREQ.GETGATEWAYSETTINGS;default:return null}};this.isEvent=function(d){switch(d){case b.EVENT.INCOMINGCALL:case b.EVENT.CALLPROGRESS:case b.EVENT.CALLCONNECTED:case b.EVENT.CALLHELD:case b.EVENT.CALLUNHELD:case b.EVENT.CALLFAILED:case b.EVENT.CALLDISPLAYNAMEUPDATED:case b.EVENT.CALLDISCONNECTED:case b.EVENT.CALLCONTROLCTI:case b.EVENT.LOGINSTATUSCHANGED:case b.EVENT.TRANSFERCOMPLETE:case b.EVENT.TRANSFERFAILURE:case b.EVENT.FARENDCHANGED:case b.EVENT.MEDIAUPDATEREQUEST:case b.EVENT.GATEWAYSETTINGSCHANGED:AWL.console.debug("Incoming Event received from GW");return true;default:AWL.console.error("Unknown Event received from GW");return false}};this.getJSON=function(){return b};this.fillParams=function(d){var e;switch(d[0]){case"login":e={extn:d[1],password:d[2],bumpConnection:d[3],tokAuth:d[4]};break;case"logout":e="NULL";break;case"makeCall":e={target:d[1],callId:d[2],sdp:d[3]};break;case"transferCall":e={target:d[1],callId:d[2],type:d[3]};break;case"answerCall":case"updateMedia":case"acceptMediaUpdateRequest":case"answerEarlyMedia":e={callId:d[1],sdp:d[2]};break;case"rejectCall":case"abortCall":case"endCall":case"holdCall":case"unholdCall":case"rejectMediaUpdateRequest":e={callId:d[1]};break;case"getGatewaySettings":e={type:d[1]};break;default:AWL.console.error("UNKNOWN msgname : "+d[0]);return null}return e}};return a}());AWL.namespace("io.JsonRpc_9_1version");AWL.io.JsonRpc_9_1version=(function(){var a=function(e){var g=this;var c=1;var d=[];var b=[];e.evtOnMessage.attach(f);this.attach=function(k,h,l){var j=k+"."+h;if(b[j]){AWL.console.warn("multiple listeners for event: "+j);delete b[j]}AWL.console.debug("listener registered for event: "+j);b[j]=l};this.detach=function(k,h){var j=k+"."+h;delete b[j]};this.call=function(){var l=Array.prototype.slice.call(arguments);if(l.length<2){AWL.console.error("not enough arguments");return}var m=l[0];var k=l[1];var j=null;var p=null;if(l.length>2){if(typeof(l[l.length-1])=="function"){j=l.pop();if(l.length>2){if(typeof(l[l.length-1])=="function"){p=j;j=l.pop()}}}}var o=null;if(l.length>2){o=l.slice(2)}var n={jsonrpc:"2.0",service:m,method:k,params:o};if(j){n.id=c++;d[n.id]={success:j,failure:p}}if(k==="login"){if(o!=null){var h={jsonrpc:"2.0",service:m,method:k,params:o[0]};h=JSON.stringify(h);AWL.console.info("sending message: "+h);e.send(JSON.stringify(n),true)}}else{e.send(JSON.stringify(n))}return n.id};function f(m,h){AWL.console.info("evtOnMessageHandler: "+h);var j=JSON.parse(h);if(j.jsonrpc!="2.0"){return}if(j.result!=null){if(!j.id){AWL.console.error("no id for message");return}var l=d[j.id];if(!l){AWL.console.error("invalid id");return}delete d[j.id];l.success(j.result);return}if(j.error){if(!j.id){AWL.console.debug("ignore. no id for message");return}var l=d[j.id];if(!l){AWL.console.error("invalid id");return}delete d[j.id];if(!l.failure){AWL.console.debug("ignore. no error callback for message");return}l.failure(j.error);return}if(j.method){var n=b[j.method];var k=0;if(!n){k=-32601}else{n(j.params)}if(j.id){var l={jsonrpc:"2.0"};if(k!=0){l.error={code:k,message:"Method not found"}}else{l.result=""}l.id=j.id;e.send(JSON.stringify(l))}}}};return a}());AWL.namespace("io.JsonRpc");AWL.io.JsonRpc=(function(){var a=function(d){var f=[];var h=new AWL.io.jsonRpc.utils();var c=[];var b=false;var g=h.getJSON().JSON_DEFAULT_FIELDVALUE.SERVICE;d.evtOnMessage.attach(e);this.attach=function(m,l){if(!b){c=[];b=true}var k=h.findMatchingResp(m);if(k===null){if(h.isEvent){k=m}else{AWL.console.error("Listener not attached for unknown Event : "+m);return}}var j=g+"."+k;if(f[j]){AWL.console.warn("multiple listeners for event: "+j);delete f[j]}AWL.console.debug("listener registered for event: "+j);f[j]=l};this.detach=function(l){if(b){b=false}var k=h.findMatchingResp(l);if(k===null){if(h.isEvent){k=l}else{AWL.console.error("Listener not attached for unknown Event : "+l);return}}var j=g+"."+k;if(f[j]){AWL.console.debug("Delete listeners for event: "+j);delete f[j]}else{AWL.console.error("Listener not attached present in notification map")}};this.setServiceType=function(j){if((j!=="phoneservice")&&(j!=="agentservice")&&(j!=="relayservice")){AWL.console.error("Invalid service type : "+j);return false}g=j};this.sendRequest=function(){var l=Array.prototype.slice.call(arguments);if(l.length<1){AWL.console.error("Mandate Json Rpc fields missing");return}var p=l[0];var m=h.getMessageId();var o=null;if(l.length>1){o=h.fillParams(l)}var k={protocol:h.getJSON().JSON_DEFAULT_FIELDVALUE.PROTOCOL,id:m,service:g,msgname:p,params:o};if(p==="login"){var n=JSON.parse(JSON.stringify(o));delete n.password;var j={protocol:h.getJSON().JSON_DEFAULT_FIELDVALUE.PROTOCOL,id:m,service:g,msgname:p,params:n};j=JSON.stringify(j);AWL.console.info("sending message: "+j);d.send(JSON.stringify(k),true)}else{d.send(JSON.stringify(k))}};function e(m,j){AWL.console.info("handleIncomingMsg: "+j);var l="";try{l=JSON.parse(j)}catch(k){AWL.console.error("Syntax error while parsing the incoming Json Rpc message");return}if(!h.isValidMsgStruct(l)){AWL.console.error("Incoming Json Rpc Message structure invalid");return}if(l.msgname){var n=f[g+"."+l.msgname];if(typeof(n)!=="undefined"){n(l.msgname,l.params)}else{AWL.console.error("No Listeners for : "+l.msgname+" message!")}}}};return a}());AWL.namespace("io.WebSocketConnection");AWL.io.WebSocketConnection=(function(){var a=function(m){var g=this;var j=null;var b=null;var c=180000;var l=10000;this.evtConnectionOpen=new AWL.Event(this);this.evtConnectionClose=new AWL.Event(this);this.evtConnectionError=new AWL.Event(this);this.evtOnMessage=new AWL.Event(this);this.evtOnBinaryMessage=new AWL.Event(this);this.type="ws";this.open=function(n){AWL.console.debug("connecting websocket to ",n," protocol ",m);b=new AWL.utilities.env.WebSocket(n,m);b.binaryType="arraybuffer";b.onopen=d;b.onmessage=f;b.onclose=h;b.onerror=e;window.onbeforeunload=function(o){b.onclose=null}};this.close=function(n,o){if(b){AWL.console.debug("closing websocket");g.evtConnectionClose.detachAll();if(n&&o){b.close(n,o)}else{b.close()}}else{AWL.console.error("Cannot close websocket. Invalid state.")}};this.send=function(o,n){if(b.readyState==1){if(!n){AWL.console.info("sending message: "+o)}b.send(o)}else{AWL.console.error("cannot send msg as connection is closed")}};this.isReady=function(){if(b.readyState==1){return true}else{return false}};function d(){AWL.console.debug("_ws_onopen");if(j!==null){clearTimeout(j)}j=setTimeout(k,(c+l));g.evtConnectionOpen.notify()}function e(n){if(j!==null){clearTimeout(j);j=null}AWL.console.warn("_ws_onerror");g.evtConnectionError.notify()}function h(n){if(j!==null){clearTimeout(j);j=null}AWL.console.debug("_ws_onclose. wasClean: "+n.wasClean+" code: "+n.code+" reason: "+n.reason);g.evtConnectionClose.notify({wasClean:n.wasClean,code:n.code,reason:n.reason})}function f(n){if(typeof n.data==="string"){if(n.data==="keepalive"){if(j!==null){clearTimeout(j)}j=setTimeout(k,(c+l));return}g.evtOnMessage.notify(n.data)}else{g.evtOnBinaryMessage.notify(n.data)}}function k(){AWL.console.warn("TOKAM from Gateway");if(j!==null){clearTimeout(j);j=null;AWL.onRegistrationStateChange.notify({result:CONST.AWL_MSG_LINK_ISSUE_DETECTED,reason:"link issue detected"})}}};return a}());AWL.namespace("webrtc.MozPC");AWL.webrtc.MozPC=(function(){var a=function(){var h=this;var j=null;var d=false;var f={};this.evtRemoteStream=new AWL.Event(this);this.evtLocalDescription=new AWL.Event(this);this.evtLocalCandidates=new AWL.Event(this);this.evtICEConnectivity=new AWL.Event(this);this.init=function(n){if(n){f=n}j=new window.mozRTCPeerConnection(f.rtcConfiguration,f.constraints);j.onicecandidate=g;j.oniceconnectionstatechange=m;j.onsignalingstatechange=e;j.onaddstream=c;j.onremovestream=k};this.close=function(){if(j){AWL.console.debug("closing peer connection");j.close();j=null}};this.addStream=function(n){AWL.console.debug("adding stream: "+n.label);j.addStream(n)};this.getStats=function(o,p,n){if(j.getStats){j.getStats(o,p,n)}};this.createOffer=function(o,p,n){if(!j){o("No active connection.");return}j.createOffer(function(q){AWL.console.debug("createOffer success.");AWL.console.debug(q);if(n){n(q);return}j.setLocalDescription(q,function(){AWL.console.debug("setLocalDescription success.");if(l()){if(b(q.sdp)){h.evtLocalDescription.notify({type:q.type,sdp:q.sdp})}}else{AWL.console.debug("Trickle ICE not supported");h.evtLocalDescription.notify({type:q.type,sdp:q.sdp})}},function(){AWL.console.error("setLocalDescription failed.");o("Failed to set local description.")})},function(){AWL.console.error("createOffer failed.");o("Failed to create offer.");return},p)};this.setRemoteDescription=function(o,n,p){var q=new mozRTCSessionDescription(o);j.setRemoteDescription(q,function(){AWL.console.debug("setRemoteDescription success.");if(o.type==="offer"){j.createAnswer(function(r){AWL.console.debug("createAnswer success.");AWL.console.debug(r);j.setLocalDescription(r,function(){AWL.console.debug("setLocalDescription success.");if(l()){if(b(r.sdp)){h.evtLocalDescription.notify({type:r.type,sdp:r.sdp})}}else{AWL.console.debug("Trickle ICE not supported");h.evtLocalDescription.notify({type:r.type,sdp:r.sdp})}},function(s){AWL.console.error("setLocalDescription failed.");n("Failed to set local description.")})},function(){AWL.console.error("createAnswer failed.");n("Failed to create answer")},p)}},function(){AWL.console.error("setRemoteDescription failed.");n("Failed to set remote description")})};this.setCustomLocalDescription=function(s,q,p){AWL.console.log("setLocalDescription: recvd cmdType = "+s);var u=j.localDescription;if(typeof(p)!=="undefined"){u.sdp=p}u.type="offer";AWL.console.debug("SDP type \n "+u.type);if(s==="hold"){u.sdp=u.sdp.replace(/^.*a=crypto:.*$/mg,"");var o=u.sdp.indexOf("m=video");if(o!==-1){var t=u.sdp.slice(o+8);t=t.substring(" ",1);AWL.console.debug("Video Port = "+t);if(t!=="0"){u.sdp=u.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}else{var r=u.sdp.slice(0,o);var n=u.sdp.slice(o);r=r.replace(/a=sendrecv\r\n/,"a=inactive\r\n");u.sdp=r.concat(n)}}else{u.sdp=u.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}}else{if(s==="unhold"){u.sdp=u.sdp.replace(/^.*a=crypto:.*$/mg,"");var o=u.sdp.indexOf("m=video");if(o!==-1){var t=u.sdp.slice(o+8);t=t.substring(" ",1);AWL.console.debug("Video Port = "+t);if(t!=="0"){u.sdp=u.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}else{var r=u.sdp.slice(0,o);var n=u.sdp.slice(o);r=r.replace(/a=inactive\r\n/,"a=sendrecv\r\n");u.sdp=r.concat(n)}}else{u.sdp=u.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}}else{if(s==="prevNegotiatedSDP"){u.sdp=p}else{AWL.console.error("Unimplemented cmdType = "+s);return}}}AWL.console.debug("Modified local "+s+" SDP:\n "+u.sdp);j.setLocalDescription(u,function(){AWL.console.debug("unHold SDP set successfully.")},function(){AWL.console.error("Failed to set unhold SDP.")})};this.getCustomLocalDescription=function(o){AWL.console.log("getLocalDescription: recvd cmdType = "+o);var r=j.localDescription;AWL.console.debug("SDP type \n "+r.type);if(o==="remVideo"){var s=r.sdp.indexOf("m=audio");var n=r.sdp.indexOf("m=video");var q=r.sdp.indexOf("a=sendrecv");var p=r.sdp.lastIndexOf("a=sendrecv");AWL.console.debug("\n idxAud = "+s+"\nidxVid = "+n+"\nidxFirst = "+q+"\nidxLast = "+p);if(n===-1){}else{if(s>n){if((q!=p)&&(q>n)&&(q<s)){r.sdp=r.sdp.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{if((q===p)&&(q>n)&&(q<s)){r.sdp=r.sdp.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpVidSDP=r.sdp.slice(0,s);tmpAudSDP=r.sdp.slice(s);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");r.sdp=tmpVidSDP.concat(tmpAudSDP)}}}else{if((q!=p)&&(q>s)&&(q<n)){tmpAudSDP=r.sdp.slice(0,n);tmpVidSDP=r.sdp.slice(n);tmpVidSDP=tmpVidSDP.replace(/a=sendrecv\r\n/,"a=inactive\r\n");r.sdp=tmpAudSDP.concat(tmpVidSDP)}else{if((q===p)&&(q>s)&&(q>n)){r.sdp=r.sdp.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpAudSDP=r.sdp.slice(0,n);tmpVidSDP=r.sdp.slice(n);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");r.sdp=tmpAudSDP.concat(tmpVidSDP)}}}}AWL.console.debug("Modified Audio Only SDP \n "+r.sdp)}else{AWL.console.error("Unsupported cmdType = "+o)}return r};this.setCustomRemoteDescription=function(s,v,p){AWL.console.log("setCustomRemoteDescription: recvd cmdType = "+s);var q={sdp:p,type:"answer"};var t=new mozRTCSessionDescription(q);AWL.console.debug("SDP type \n "+t.type);if(s==="hold"){var o=t.sdp.indexOf("m=video");if(o!==-1){var u=t.sdp.slice(o+8);u=u.substring(" ",1);AWL.console.debug("Video Port = "+u);if(u!=="0"){t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}else{var n=t.sdp.slice(0,o);var r=t.sdp.slice(o);n=n.replace(/a=sendrecv\r\n/,"a=inactive\r\n");t.sdp=n.concat(r)}}else{t.sdp=t.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}}else{if(s==="unhold"){var o=t.sdp.indexOf("m=video");if(o!==-1){var u=t.sdp.slice(o+8);u=u.substring(" ",1);AWL.console.debug("Video Port = "+u);if(u!=="0"){t.sdp=t.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}else{var n=t.sdp.slice(0,o);var r=t.sdp.slice(o);n=n.replace(/a=inactive\r\n/,"a=sendrecv\r\n");t.sdp=n.concat(r)}}else{t.sdp=t.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}}else{if(s==="prevNegotiatedSDP"){}else{AWL.console.error("Unsupported cmdType = "+s);return}}}AWL.console.debug("Modified remote "+s+" SDP: \n "+t.sdp);j.setRemoteDescription(t,function(){AWL.console.debug("Remote SDP for "+s+" set successfully")},function(){AWL.console.error("Failed to set remote SDP for "+s)})};this.addIceCandidate=function(n){var o=new RTCIceCandidate(n);j.addIceCandidate(o)};function e(n){AWL.console.debug("pc_onsignalingstatechange: ",n.target.signalingState)}function m(n){AWL.console.info("pc_oniceconnectionstatechange: ",n.target.iceConnectionState);h.evtICEConnectivity.notify({iceStatus:n.target.iceConnectionState})}function c(n){AWL.console.debug("pc_onaddstream");var o=n.stream;setTimeout(function(){var q="";var p=o.getVideoTracks();var r=o.getAudioTracks();if(r&&r.length>0){q="audio"}if(p&&p.length>0){q=q+"video"}h.evtRemoteStream.notify({stream:n.stream,type:q})},500)}function k(n){AWL.console.debug("pc_onremovestream")}function g(o){AWL.console.debug("pc_onicecandidate: "+o.candidate);if(l()){if(!d&&o.candidate===null){d=true;AWL.console.info("ICE candidates received. Sending SDP");var n="offer";if(j.remoteDescription){n="answer"}h.evtLocalDescription.notify({type:n,sdp:j.localDescription.sdp})}}}function b(n){if(n.indexOf("a=candidate")!=-1){return true}else{return false}}function l(){var n=navigator.userAgent.match(/Firefox\/(.*)$/);if(n&&n.length>1){if(n[1]>=34){return true}}return false}};return a}());AWL.namespace("webrtc.WebKitPC");AWL.webrtc.WebKitPC=(function(){var a=function(){var m=this;var o=null;var e={};var d=false;var g=false;var f=false;this.evtRemoteStream=new AWL.Event(this);this.evtLocalDescription=new AWL.Event(this);this.evtLocalCandidates=new AWL.Event(this);this.evtICEConnectivity=new AWL.Event(this);this.evtReattachingStream=new AWL.Event(this);this.init=function(r){if(r){e=r}var s=e.constraints.optional.length;e.constraints.optional[s]={googIPv6:false};e.constraints.optional[s+1]={googDscp:true};g=false;f=false;o=new window.webkitRTCPeerConnection(e.rtcConfiguration,e.constraints);o.onnegotiationneeded=k;o.onicecandidate=l;o.onsignalingstatechange=c;o.oniceconnectionstatechange=q;o.onaddstream=b;o.onremovestream=p};this.close=function(){if(o){AWL.console.debug("closing peer connection");o.close();o=null}};this.createDTMFSender=function(r){return o.createDTMFSender(r)};this.addStream=function(r){o.addStream(r)};this.getStats=function(r){if(o.getStats){o.getStats(r)}};this.createOffer=function(r,s){if(!o){r("No active connection.");return}o.createOffer(function(u){AWL.console.debug("createOffer success.");AWL.console.debug("Offer before DTMF payload being set: ");AWL.console.debug(u.sdp);var y=JSON.stringify(u.sdp);var w=y.split("\\n");var t="";for(var x=0;x<w.length;x++){if(w[x].indexOf("telephone-event")!==-1){var v=w[x].indexOf("a=rtpmap:");if(v!==-1){t=w[x].slice(v+9,v+12);w[x]=w[x].replace(t,AWL.dtmfPayLoadType)}}}if(t){for(var x=0;x<w.length;x++){if(((w[x].indexOf("m=audio")!==-1)||(w[x].indexOf("a=fmtp:"+t)!==-1))&&(w[x].indexOf(t)!==-1)){w[x]=w[x].replace(t,AWL.dtmfPayLoadType)}}}y=w.join("\\n");u.sdp=JSON.parse(y);AWL.console.debug("SDP after DTMF payload is set: ");AWL.console.debug(u.sdp);o.setLocalDescription(u,function(){AWL.console.debug("setLocalDescription success.");if(h(u.sdp)){m.evtLocalDescription.notify({type:u.type,sdp:u.sdp})}},function(){AWL.console.error("setLocalDescription failed.");r("Failed to set local description.")})},function(){AWL.console.error("createOffer failed.");r("Failed to create offer.");return},s)};this.setRemoteDescription=function(s,r,t){var u=new RTCSessionDescription(s);o.setRemoteDescription(u,function(){AWL.console.debug("setRemoteDescription success.");if(s.type==="offer"){o.createAnswer(function(v){AWL.console.debug("createAnswer success.");AWL.console.debug(v);o.setLocalDescription(v,function(){AWL.console.debug("setLocalDescription success.");if(h(v.sdp)){m.evtLocalDescription.notify({type:v.type,sdp:v.sdp})}},function(){AWL.console.error("setLocalDescription failed.");r("Failed to set local description.")})},function(){AWL.console.error("createAnswer failed.");r("Failed to create answer")},t)}},function(v){AWL.console.error("setRemoteDescription failed.");r("Failed to set remote description")})};this.setCustomLocalDescription=function(v,B,t){AWL.console.log("setLocalDescription: recvd cmdType = "+v);var w=o.localDescription;w.type="offer";AWL.console.debug("SDP type \n "+w.type);if(v==="hold"){w.sdp=w.sdp.replace(/^.*a=crypto:.*$/mg,"");var s=w.sdp.indexOf("m=video");if(s!==-1){var x=w.sdp.slice(s+8);if(x.indexOf("inactive")!==-1){g=true}x=x.substring(" ",1);AWL.console.debug("Video Port = "+x);if(x!=="0"){w.sdp=w.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}else{var r=w.sdp.slice(0,s);var u=w.sdp.slice(s);r=r.replace(/a=sendrecv\r\n/,"a=inactive\r\n");w.sdp=r.concat(u)}}else{w.sdp=w.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}if(B==="passive"||B==="active"){w.sdp=w.sdp.replace(/a=setup:passive\r\n/g,"a=setup:actpass\r\n");w.sdp=w.sdp.replace(/a=setup:active\r\n/g,"a=setup:actpass\r\n");if(w.sdp.indexOf("a=setup:actpass")===-1){AWL.console.debug("Adding actpass");var A=w.sdp.indexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}A=w.sdp.lastIndexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}}}else{AWL.console.warn("setLocalDescription: unknown dtlsRole "+B)}}else{if(v==="unhold"){w.sdp=w.sdp.replace(/^.*a=crypto:.*$/mg,"");var s=w.sdp.indexOf("m=video");if(s!==-1){var x=w.sdp.slice(s+8);x=x.substring(" ",1);AWL.console.debug("Video Port = "+x);if(x!=="0"){if(g){var r=w.sdp.slice(0,s);var u=w.sdp.slice(s);r=r.replace(/a=inactive\r\n/,"a=sendrecv\r\n");w.sdp=r.concat(u)}else{w.sdp=w.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}}else{var r=w.sdp.slice(0,s);var u=w.sdp.slice(s);r=r.replace(/a=inactive\r\n/,"a=sendrecv\r\n");w.sdp=r.concat(u)}g=false}else{w.sdp=w.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}if(B==="passive"||B==="active"){w.sdp=w.sdp.replace(/a=setup:passive\r\n/g,"a=setup:actpass\r\n");w.sdp=w.sdp.replace(/a=setup:active\r\n/g,"a=setup:actpass\r\n");if(w.sdp.indexOf("a=setup:actpass")===-1){AWL.console.debug("Adding actpass");var A=w.sdp.indexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}A=w.sdp.lastIndexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}}}else{AWL.console.warn("setLocalDescription: unknown dtlsRole "+B)}}else{if(v==="prevNegotiatedSDP"){w.sdp=t}else{if(v==="removeVideo"){var s=w.sdp.indexOf("m=video");var r=w.sdp.slice(0,s);var u=w.sdp.slice(s);u=u.replace(/a=sendrecv\r\n/,"a=inactive\r\n");w.sdp=r.concat(u);if(B==="passive"||B==="active"){w.sdp=w.sdp.replace(/a=setup:passive\r\n/g,"a=setup:actpass\r\n");w.sdp=w.sdp.replace(/a=setup:active\r\n/g,"a=setup:actpass\r\n");if(w.sdp.indexOf("a=setup:actpass")===-1){AWL.console.debug("Adding actpass");var A=w.sdp.indexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}A=w.sdp.lastIndexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}}}else{AWL.console.warn("setLocalDescription: unknown dtlsRole "+B)}}else{if(v==="addVideo"){var s=w.sdp.indexOf("m=video");var r=w.sdp.slice(0,s);var u=w.sdp.slice(s);u=u.replace(/a=inactive\r\n/,"a=sendrecv\r\n");w.sdp=r.concat(u);if(B==="passive"||B==="active"){w.sdp=w.sdp.replace(/a=setup:passive\r\n/g,"a=setup:actpass\r\n");w.sdp=w.sdp.replace(/a=setup:active\r\n/g,"a=setup:actpass\r\n");if(w.sdp.indexOf("a=setup:actpass")===-1){AWL.console.debug("Adding actpass");var A=w.sdp.indexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}A=w.sdp.lastIndexOf("c=IN");if(A!==-1){var z=w.sdp.slice(0,A);var y=w.sdp.slice(A);z=z.concat("a=setup:actpass\r\n");w.sdp=z.concat(y)}}}}else{AWL.console.error("Unsupported cmdType = "+v);return}}}}}AWL.console.debug("Modified local "+v+" SDP:\n "+w.sdp);o.setLocalDescription(w,function(){AWL.console.debug("Hold SDP set successfully.")},function(){AWL.console.error("Failed to set Hold SDP.")})};this.setCustomRemoteDescription=function(w,C,t){AWL.console.log("setCustomRemoteDescription: recvd cmdType = "+w);var u={sdp:t,type:"answer"};var x=new RTCSessionDescription(u);AWL.console.debug("SDP type \n "+x.type);if((w==="hold")){var s=x.sdp.indexOf("m=video");if(s!==-1){var y=x.sdp.slice(s+8);if(y.indexOf("inactive")!==-1){f=true}y=y.substring(" ",1);AWL.console.debug("Video Port = "+y);if(y!=="0"){x.sdp=x.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}else{var r=x.sdp.slice(0,s);var v=x.sdp.slice(s);r=r.replace(/a=sendrecv\r\n/,"a=inactive\r\n");x.sdp=r.concat(v)}}else{x.sdp=x.sdp.replace(/a=sendrecv\r\n/g,"a=inactive\r\n")}if(C==="passive"){if(x.sdp.indexOf("a=setup:")===-1){AWL.console.debug("Adding passive");var B=x.sdp.indexOf("c=IN");if(B!==-1){var A=x.sdp.slice(0,B);var z=x.sdp.slice(B);A=A.concat("a=setup:passive\r\n");x.sdp=A.concat(z)}B=x.sdp.lastIndexOf("c=IN");if(B!==-1){var A=x.sdp.slice(0,B);var z=x.sdp.slice(B);A=A.concat("a=setup:passive\r\n");x.sdp=A.concat(z)}}}}else{if(w==="unhold"){var s=x.sdp.indexOf("m=video");if(s!==-1){var y=x.sdp.slice(s+8);y=y.substring(" ",1);AWL.console.debug("Video Port = "+y);if(y!=="0"){if(f){var r=x.sdp.slice(0,s);var v=x.sdp.slice(s);r=r.replace(/a=inactive\r\n/,"a=sendrecv\r\n");x.sdp=r.concat(v)}else{x.sdp=x.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}}else{var r=x.sdp.slice(0,s);var v=x.sdp.slice(s);r=r.replace(/a=inactive\r\n/,"a=sendrecv\r\n");x.sdp=r.concat(v)}f=false}else{x.sdp=x.sdp.replace(/a=inactive\r\n/g,"a=sendrecv\r\n")}if(C==="passive"){if(x.sdp.indexOf("a=setup:")===-1){AWL.console.debug("Adding actpass");var B=x.sdp.indexOf("c=IN");if(B!==-1){var A=x.sdp.slice(0,B);var z=x.sdp.slice(B);A=A.concat("a=setup:passive\r\n");x.sdp=A.concat(z)}B=x.sdp.lastIndexOf("c=IN");if(B!==-1){var A=x.sdp.slice(0,B);var z=x.sdp.slice(B);A=A.concat("a=setup:passive\r\n");x.sdp=A.concat(z)}}}}else{if(w==="upgrade"){if(C==="passive"){if(x.sdp.indexOf("a=setup:")===-1){AWL.console.debug("Adding passive");var B=x.sdp.indexOf("c=IN");if(B!==-1){var A=x.sdp.slice(0,B);var z=x.sdp.slice(B);A=A.concat("a=setup:passive\r\n");x.sdp=A.concat(z)}B=x.sdp.lastIndexOf("c=IN");if(B!==-1){var A=x.sdp.slice(0,B);var z=x.sdp.slice(B);A=A.concat("a=setup:passive\r\n");x.sdp=A.concat(z)}}}}else{if(w==="prevNegotiatedSDP"){}else{AWL.console.error("Unsupported cmdType = "+w);return}}}}AWL.console.debug("Modified remote "+w+" SDP:\n "+x.sdp);o.setRemoteDescription(x,function(){AWL.console.debug("Remote SDP for "+w+" set successfully")},function(){AWL.console.error("Failed to set remote SDP for "+w)})};this.getCustomLocalDescription=function(s){AWL.console.log("getLocalDescription: recvd cmdType = "+s);var v=o.localDescription;AWL.console.debug("SDP type \n "+v.type);if(s==="remVideo"){var w=v.sdp.indexOf("m=audio");var r=v.sdp.indexOf("m=video");var u=v.sdp.indexOf("a=sendrecv");var t=v.sdp.lastIndexOf("a=sendrecv");AWL.console.debug("\n idxAud = "+w+"\nidxVid = "+r+"\nidxFirst = "+u+"\nidxLast = "+t);if(r===-1){}else{if(w>r){if((u!=t)&&(u>r)&&(u<w)){v.sdp=v.sdp.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{if((u===t)&&(u>r)&&(u<w)){v.sdp=v.sdp.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpVidSDP=v.sdp.slice(0,w);tmpAudSDP=v.sdp.slice(w);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");v.sdp=tmpVidSDP.concat(tmpAudSDP)}}}else{if((u!=t)&&(u>w)&&(u<r)){tmpAudSDP=v.sdp.slice(0,r);tmpVidSDP=v.sdp.slice(r);tmpVidSDP=tmpVidSDP.replace(/a=sendrecv\r\n/,"a=inactive\r\n");v.sdp=tmpAudSDP.concat(tmpVidSDP)}else{if((u===t)&&(u>w)&&(u>r)){v.sdp=v.sdp.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpAudSDP=v.sdp.slice(0,r);tmpVidSDP=v.sdp.slice(r);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");v.sdp=tmpAudSDP.concat(tmpVidSDP)}}}}AWL.console.debug("Modified Audio Only SDP \n "+v.sdp)}else{AWL.console.error("Unsupported cmdType = "+s)}return v};this.addIceCandidate=function(r){var s=new RTCIceCandidate(r);o.addIceCandidate(s)};function h(s){var x=s.indexOf("m=audio");var r=s.indexOf("m=video");var w=s.indexOf("a=candidate");var u=s.lastIndexOf("a=candidate");var t=false;if((x!==-1)&&(w!==-1)){if(r!==-1){var v=s.slice(r+8);v=v.substring(" ",1);AWL.console.debug("Video Port = "+v);if(v!=="0"){if(u>r){t=true}else{d=false;AWL.console.debug("Video SDP without candidates")}}else{AWL.console.debug("No candidate gathering required when video port is zero, but allow sending SDP");t=true}}else{if(r===-1){t=true}else{d=false;AWL.console.debug("Video SDP without candidates")}}}else{d=false;AWL.console.debug("Audio SDP without candidates")}return t}function k(r){AWL.console.debug("pc_onnegotiationneeded")}function c(r){AWL.console.debug("pc_onsignalingstatechange: ",r.target.signalingState)}function q(r){AWL.console.info("pc_oniceconnectionstatechange: ",r.target.iceConnectionState);m.evtICEConnectivity.notify({iceStatus:r.target.iceConnectionState})}function b(t){AWL.console.debug("pc_onaddstream");var u=t.stream;var s="";var r=null;var v=null;t.stream.onaddtrack=n;t.stream.onremovetrack=j;if(!webkitMediaStream.prototype.getVideoTracks){v=u.audioTracks;r=u.videoTracks}else{r=u.getVideoTracks();v=u.getAudioTracks()}if(v&&v.length>0){s="audio"}if(r&&r.length>0){s=s+"video"}m.evtRemoteStream.notify({stream:t.stream,type:s})}function p(r){AWL.console.debug("pc_onremovestream")}function l(s){AWL.console.debug("pc_onicecandidate: "+s.candidate);if(!d&&s.candidate===null){d=true;AWL.console.info("ICE candidates received. Sending SDP");var r="offer";if(o.remoteDescription){r="answer"}m.evtLocalDescription.notify({type:r,sdp:o.localDescription.sdp})}}function n(r){AWL.console.debug("Added track; reattaching video media stream.");m.evtReattachingStream.notify(r)}function j(r){AWL.console.debug("Removed video track")}};return a}());AWL.namespace("webrtc");AWL.webrtc=(function(){var c=(function(){if(window.webkitRTCPeerConnection){return AWL.webrtc.WebKitPC}else{if(window.mozRTCPeerConnection){return AWL.webrtc.MozPC}else{return null}}}());function f(l,j,k){if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(l,j,k)}else{if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(l,j,k)}else{return null}}}var d=(function(){if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){return true}else{if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){return true}else{return false}}}());function g(j){if(navigator.webkitGetUserMedia){if(a()){webkitURL.revokeObjectURL(j.srcObject)}else{URL.revokeObjectURL(j.srcObject)}j.src=""}else{URL.revokeObjectURL(j.mozSrcObject);j.src=""}}function b(j,k){if(navigator.webkitGetUserMedia){j.srcObject=k}else{j.mozSrcObject=k;j.play()}}function e(j){if(j.mozRequestFullScreen){j.mozRequestFullScreen()}else{if(j.webkitRequestFullscreen){j.webkitRequestFullscreen()}}}function h(){var j=navigator.userAgent.match(/Firefox\/(.*)$/);if(j&&j.length>1){if(j[1]>=38){return true}}return false}function a(){var l=navigator.userAgent.indexOf("Chrome/");var k=navigator.userAgent.indexOf(".",l);var j=parseInt(navigator.userAgent.substring(l+7,k));AWL.console.debug("Chrome version: "+j);if(j<47){return true}return false}return{PeerConnection:c,getUserMedia:f,exists:d,mediaReset:g,mediaSetStream:b,launchFullScreen:e,mozRenegotiationSupport:h,webkitURLSupported:a}}());AWL.namespace("configuration");AWL.configuration=(function(){var a;var b=function(){var c={serviceType:"phone",enableVideo:false,Gateway:{ip:"",port:""},Stunserver:{ip:"",port:"3478"},Turnserver:{ip:"",port:"3478",user:"",pwd:""}};var e={localVideo:"",remoteVideo:"",relayAudioTagId:""};var k={audioInputID:"",videoInputID:"",audioOutputID:"",defaultId:true};var h="",g="";this._setConfiguration=function(m){AWL.console.info("config.setConfiguration\n");AWL.console.info("\nAWL SDK Version : "+CONST.AWL_VERSION);var n=CONST.AWL_MSG_SETCONFIG_FAILED;var l="config object literal notation incorrect";if(m){if(typeof(m.serviceType)!=="undefined"){if(m.serviceType!==null){if(m.serviceType==="phone"){AWL.serviceType=CONST.PHONESERVICE;c.serviceType=m.serviceType}else{if(m.serviceType==="agent"){AWL.serviceType=CONST.AGENTSERVICE;c.serviceType=m.serviceType}else{if(m.serviceType==="relay"){AWL.serviceType=CONST.RELAYSERVICE;c.serviceType=m.serviceType}else{AWL.serviceType=CONST.PHONESERVICE;c.serviceType=m.serviceType}}}AWL.console.info("\nconfig.setConfiguration: serviceType "+m.serviceType);n=CONST.AWL_MSG_SETCONFIG_SUCCESS}}if(typeof(m.enableVideo)!=="undefined"){if(m.enableVideo!==null){AWL.console.info("\nconfig.setConfiguration: enableVideo "+m.enableVideo);c.enableVideo=m.enableVideo;n=CONST.AWL_MSG_SETCONFIG_SUCCESS}}if(typeof(m.Gateway)!=="undefined"){if(m.Gateway.ip!==null){if((j(m.Gateway.ip))||(f(m.Gateway.ip))||(d(m.Gateway.ip))){AWL.console.info("\nconfig.setConfiguration: Gateway IP "+m.Gateway.ip);c.Gateway.ip=m.Gateway.ip;if(typeof(m.Gateway.port)!=="undefined"){if(m.Gateway.port!==null){AWL.console.info("\nconfig.setConfiguration: Gateway port "+m.Gateway.port);c.Gateway.port=m.Gateway.port}else{AWL.console.warn("\nconfig.setConfiguration: port null");c.Gateway.port=""}}else{AWL.console.warn("\nconfig.setConfiguration: port undefined");c.Gateway.port=""}n=CONST.AWL_MSG_SETCONFIG_SUCCESS}else{AWL.clientAPIConsole.error("\nClient Api :: setConfiguration - Gateway IP is invalid");n=CONST.AWL_MSG_SETCONFIG_FAILED}}}if(typeof(m.Stunserver)!=="undefined"){if(m.Stunserver.ip!==null){AWL.console.info("\nconfig.setConfiguration: Stunserver IP "+m.Stunserver.ip);if((j(m.Stunserver.ip))||(f(m.Stunserver.ip))||(d(m.Stunserver.ip))){c.Stunserver.ip=m.Stunserver.ip;if(m.Stunserver.port!==null){AWL.console.info("\nconfig.setConfiguration: Stunserver port "+m.Stunserver.port);c.Stunserver.port=m.Stunserver.port}h={url:"stun:"+c.Stunserver.ip+":"+c.Stunserver.port};AWL.console.info("\nconfig.setConfiguration: Stunserver url "+h);n=CONST.AWL_MSG_SETCONFIG_SUCCESS}}}if(typeof(m.Turnserver)!=="undefined"){if((m.Turnserver.ip!==null)&&(m.Turnserver.user!==null)&&(m.Turnserver.pwd!==null)){AWL.console.info("\nconfig.setConfiguration: Turnserver IP "+m.Turnserver.ip);if((j(m.Turnserver.ip))||(f(m.Turnserver.ip))||(d(m.Turnserver.ip))){c.Turnserver.ip=m.Turnserver.ip;if(m.Turnserver.port!==null){AWL.console.info("\nconfig.setConfiguration: Turnserver port "+m.Turnserver.port);c.Turnserver.port=m.Turnserver.port}AWL.console.info("\nconfig.setConfiguration: Turnserver user "+m.Turnserver.user);c.Turnserver.user=m.Turnserver.user;AWL.console.info("\nconfig.setConfiguration: Turnserver pwd "+m.Turnserver.pwd);c.Turnserver.pwd=m.Turnserver.pwd;g={url:"turn:"+c.Turnserver.ip+":"+c.Turnserver.port,credential:c.Turnserver.pwd,username:c.Turnserver.user};AWL.console.info("\nconfig.setConfiguration: Turnserver url "+g);n=CONST.AWL_MSG_SETCONFIG_SUCCESS}}}if(n===CONST.AWL_MSG_SETCONFIG_SUCCESS){l="none"}}AWL.onConfigChange.notify({result:n,reason:l});return n};this._getConfiguration=function(){AWL.console.debug("config.getConfiguration\n");return c};this._getStunServerURL=function(){AWL.console.debug("config._getStunServerURL\n");return h};this._getTurnServerURL=function(){AWL.console.debug("config._getTurnServerURL\n");return g};this._setDomElements=function(n){var m=CONST.AWL_MSG_SETDOM_FAILED;var l="DOM element missing";if(n){if(typeof(n.localVideo)!=="undefined"){if(n.localVideo!==null){e.localVideo=n.localVideo;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(typeof(n.remoteVideo)!=="undefined"){if(n.remoteVideo!==null){e.remoteVideo=n.remoteVideo;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(typeof(n.relayAudioTagId)!=="undefined"){if(n.relayAudioTagId!==null){e.relayAudioTagId=n.relayAudioTagId;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(m===CONST.AWL_MSG_SETDOM_SUCCESS){l="none"}}AWL.onConfigChange.notify({result:m,reason:l});return m};this._getDomElements=function(){AWL.console.debug("\ndomElement.getDomElements");return e};this._setDeviceIds=function(n){var m=CONST.AWL_MSG_SETDOM_FAILED;var l="DOM element missing";if(n){if(typeof(n.audioInputID)!=="undefined"){if(n.audioInputID!==null){k.audioInputID=n.audioInputID;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(typeof(n.videoInputID)!=="undefined"){if(n.videoInputID!==null){k.videoInputID=n.videoInputID;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(typeof(n.defaultId)!=="undefined"){if(n.defaultId!==null){k.defaultId=n.defaultId;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(typeof(n.audioOutputID)!=="undefined"){if(n.audioOutputID!==null){k.audioOutputID=n.audioOutputID;m=CONST.AWL_MSG_SETDOM_SUCCESS}}if(m===CONST.AWL_MSG_SETDOM_SUCCESS){l="none"}}AWL.onConfigChange.notify({result:m,reason:l});return m};this._getDeviceIds=function(){AWL.console.debug("\ndeviceIds.getDeviceIds");return k};var j=function(m){var l=m.split(".");if(l.length===4){return l.every(function(n){return(parseInt(n,10)>=0&&parseInt(n,10)<=255)})}return false};var f=function(m){var l=new RegExp("^([a-z0-9]+\\.)?([a-z0-9][a-z0-9-]*\\.)+[a-z]{2,6}$","i");if(l.test(m)){return true}return false};var d=function(m){var l=new RegExp("^(?:[a-zA-Z0-9]+|[a-zA-Z0-9][-a-zA-Z0-9]+[a-zA-Z0-9])(?:.[a-zA-Z0-9]+|[a-zA-Z0-9][-a-zA-Z0-9]+[a-zA-Z0-9])?$","i");if(l.test(m)&&m.length<=255){return true}return false};return{setConfiguration:_setConfiguration,getConfiguration:_getConfiguration,getStunServerURL:_getStunServerURL,getTurnServerURL:_getTurnServerURL,setDomElements:_setDomElements,getDomElements:_getDomElements,setDeviceIds:_setDeviceIds,getDeviceIds:_getDeviceIds}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("services");AWL.services=(function(){var a;var b=function(){this._initJsonRpcServices=function(){if(AWL.inUse_Version==="10.0"){AWL.jsonRpc=new AWL.io.JsonRpc(AWL.wsConnection);if((AWL.serviceType===CONST.PHONESERVICE)||(AWL.serviceType===CONST.AGENTSERVICE)){AWL.jsonRpc.setServiceType(AWL.serviceType);AWL.jsonRpc.attach("IncomingCall",AWL.callmanager.getInstance().incomingCallHandler);AWL.jsonRpc.attach("makeCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("transferCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("answerCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("CallProgressing",AWL.callmanager.getInstance().callProgressHandler);AWL.jsonRpc.attach("rejectCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("abortCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("endCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("holdCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("unholdCall",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("updateMedia",AWL.callmanager.getInstance().mediaUpdateHandler);AWL.jsonRpc.attach("acceptMediaUpdateRequest",AWL.callmanager.getInstance().mediaUpdateHandler);AWL.jsonRpc.attach("rejectMediaUpdateRequest",AWL.callmanager.getInstance().mediaUpdateHandler);AWL.jsonRpc.attach("CallDisconnected",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("CallHeld",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("CallUnheld",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("CallConnected",AWL.callmanager.getInstance().mediaAnswerHandler);AWL.jsonRpc.attach("CallTransferSuccessful",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("CallTransferFailed",AWL.callmanager.getInstance().callStateHandler);AWL.jsonRpc.attach("CallCtiEventReceived",AWL.callmanager.getInstance().callControllerHandler);AWL.jsonRpc.attach("FarEndChanged",AWL.callmanager.getInstance().callUpdateHandler);AWL.jsonRpc.attach("MediaUpdateRequest",AWL.callmanager.getInstance().mediaUpdateHandler);AWL.jsonRpc.attach("answerEarlyMedia",AWL.callmanager.getInstance().callStateHandler)}else{if(AWL.serviceType===CONST.RELAYSERVICE){AWL.jsonRpc.setServiceType(AWL.serviceType);AWL.jsonRpc.attach("IncomingCall",AWL.loopBack.getInstance().incomingCallHandler);AWL.jsonRpc.attach("CallDisconnected",AWL.loopBack.getInstance().callStateHandler);AWL.jsonRpc.attach("CallProgressing",AWL.loopBack.getInstance().callStateHandler);AWL.jsonRpc.attach("CallConnected",AWL.loopBack.getInstance().mediaAnswerHandler);AWL.jsonRpc.attach("Update",AWL.loopBack.getInstance().callUpdateHandler)}else{AWL.console.error("Unknown service type set")}}}else{AWL.jsonRpc=new AWL.io.JsonRpc_9_1version(AWL.wsConnection);if((AWL.serviceType===CONST.PHONESERVICE)||(AWL.serviceType===CONST.AGENTSERVICE)){AWL.jsonRpc.attach(AWL.serviceType,"incomingCall",AWL.callmanager_9_1version.getInstance().incomingCallHandler);AWL.jsonRpc.attach(AWL.serviceType,"callState",AWL.callmanager_9_1version.getInstance().callStateHandler);AWL.jsonRpc.attach(AWL.serviceType,"mediaAnswer",AWL.callmanager_9_1version.getInstance().mediaAnswerHandler);AWL.jsonRpc.attach(AWL.serviceType,"update",AWL.callmanager_9_1version.getInstance().callUpdateHandler)}else{AWL.console.error("Unknown service type set")}if(AWL.serviceType===CONST.AGENTSERVICE){AWL.jsonRpc.attach(AWL.serviceType,"callController",AWL.callmanager_9_1version.getInstance().callControllerHandler)}}};return{initJsonRpcServices:_initJsonRpcServices}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("registration");AWL.registration=(function(){var q;var f=this;var g,e,c,n=false,h="false",p="false",v=null,u=null,l=null,t,j=false,s;var m="",o="",k="",d="",b=false;var r={GW_9_1:"7070",GW_10_0:"9443"};var a=function(){this.init=function(){AWL.console.debug("\nAWL.registration :: init Function");g="";e="";c="";t="";AWL.localStream=null;AWL.remoteStreams=new Array();I();B();AWL.muteAllStreams=false;AWL.videoPaused=false;n=false};this._logIn=function(O,J,M,K){AWL.console.info("registration._logIn\n");if(AWL.serviceType!==CONST.RELAYSERVICE){if(f._isloggedIn()){AWL.clientAPIConsole.error("Client Api : User already logged in, aborting another login request!");AWL.onRegistrationStateChange.notify({result:CONST.AWL_MSG_DUPLICATE_LOGIN,reason:"Already loggedin. Rejecting duplicate login"});return false}}var L="";f.init();h=M;p=K;if((O.trim()).length===0){L=CONST.AWL_MSG_LOGIN_EMPTYUSERNAME}g=O;if((J.trim()).length===0){L=CONST.AWL_MSG_LOGIN_EMPTYPASSWORD}e=J;var N=AWL.configuration.getInstance().getConfiguration().Gateway.ip;s=AWL.configuration.getInstance().getConfiguration().Gateway.port;if(s===""){if(j){s=r.GW_9_1;j=false}else{s=r.GW_10_0}}if(s===r.GW_9_1){AWL.inUse_Version="9.1"}else{AWL.inUse_Version="10.0";s=r.GW_10_0}if((N.trim()).length===0){L=CONST.AWL_MSG_LOGIN_GW_NOTCONFIGURED}if(L!=""){AWL.onRegistrationStateChange.notify({result:L,reason:"Login parameters incorrect"});return false}AWL.connectionmanager.getInstance().createWebsocketConnection(N,s,AWL.registration.getInstance())};this._logOut=function(){if(f._isloggedIn()){AWL.console.info("registration.logout");if(AWL.inUse_Version==="9.1"){AWL.jsonRpc.call(AWL.serviceType,"logout");D()}else{AWL.jsonRpc.sendRequest("logout");D()}}else{AWL.clientAPIConsole.error("\nClient Api :: Logout denied as client not logged in yet")}};this._isloggedIn=function(){return n};this._playStream=function(){_audioSource.loop=true;var J=document.getElementById(AWL.configuration.getInstance().getDomElements().relayAudioTagId);J.autoplay=true;J.play();J.load()};this._stopStream=function(){var J=document.getElementById(AWL.configuration.getInstance().getDomElements().relayAudioTagId);J.pause()};function D(J){if(AWL.serviceType!==CONST.RELAYSERVICE){if(typeof(J)==="undefined"){AWL.callmanager.getInstance().cleanUpCallsIfRequired("manual logout")}else{if(typeof(J.result)!=="undefined"){if(J.result===CONST.AWL_MSG_LOGIN_WEBSOCKET_FAILURE){AWL.callmanager.getInstance().cleanUpCallsIfRequired("GW connection lost")}}}}else{AWL.loopBack.getInstance().endLoopBackConnection();AWL.loopBack.getInstance().resetCall()}I();B();if(AWL.serviceType===CONST.RELAYSERVICE){f._stopStream()}n=false;AWL.muteAllStreams=false;if(typeof(J)==="undefined"){AWL.onRegistrationStateChange.notify({result:CONST.AWL_MSG_LOGGEDOUT,reason:"Logout successful"})}else{if((typeof(J.result)!=="undefined")&&(typeof(J.reason)!=="undefined")){AWL.onRegistrationStateChange.notify({result:J.result,reason:J.reason})}}}function C(){D({result:CONST.AWL_MSG_DEVICEACCESS_FAILURE,reason:"Timeout happened on mediaallow prompt choice"});setTimeout(function(){location.reload(true)},2000)}this._evtWebSocketConnectionOpenHandler=function(K,J){AWL.console.info("evtWebSocketConnectionOpenHandler");if(AWL.serviceType===CONST.RELAYSERVICE){if(AWL.configuration.getInstance().getDomElements().relayAudioTagId!==""){E(F())}else{AWL.console.error("Mandate relay audio tag not set - deny login");D({result:CONST.AWL_MSG_LOGIN_FAILED,reason:"Mandate relay audio tag not set"})}}else{E()}};this._evtWebSocketConnectionCloseHandler=function(L,K){AWL.console.debug("evtWebSocketConnectionCloseHandler: "+K.wasClean);var J="";if(K.wasClean){AWL.console.error("Connection closed by server: "+K.reason)}else{AWL.console.error("Unknown connection error: "+K.code)}if(K.code===1006){J="Connection to WebRTC Gateway failed"}else{if(K.code===1001){J="CLOSE_GOING_AWAY"}else{if(K.code===1002){J="CLOSE_PROTOCOL_ERROR"}else{if(K.code===1003){J="CLOSE_UNSUPPORTED"}else{if(K.code===1000){J="CLOSE_NORMAL"}else{if(K.code===1009){J="CLOSE_TOO_LARGE"}else{J=K.code}}}}}}if(K.code===1006){if(AWL.serviceType!==CONST.RELAYSERVICE&&AWL.configuration.getInstance().getConfiguration().Gateway.port===""&&s===r.GW_10_0){w()}else{D({result:CONST.AWL_MSG_LOGIN_WEBSOCKET_FAILURE,reason:J})}}else{D({result:CONST.AWL_MSG_LOGIN_WEBSOCKET_FAILURE,reason:J})}};function E(J){AWL.console.debug("evtMediaDeviceAccessAcquired");AWL.services.getInstance().initJsonRpcServices();if(AWL.serviceType===CONST.RELAYSERVICE){AWL.loopBack.getInstance().setLocalStream(J)}if(AWL.inUse_Version==="9.1"){AWL.jsonRpc.attach(AWL.serviceType,"loginStatus",y);AWL.jsonRpc.attach(AWL.serviceType,"gatewaySettingsChanged",A);AWL.jsonRpc.attach(AWL.serviceType,"gatewaySettingsResponse",G);AWL.jsonRpc.call(AWL.serviceType,"getGatewaySettings","all");AWL.jsonRpc.call(AWL.serviceType,"login",g,e)}else{AWL.jsonRpc.attach("login",y);AWL.jsonRpc.attach("logout",x);AWL.jsonRpc.attach("LoginStatusChanged",z);AWL.jsonRpc.attach("GatewaySettingsChanged",A);AWL.jsonRpc.attach("gatewaySettingsResponse",G);AWL.jsonRpc.sendRequest("getGatewaySettings","all");AWL.jsonRpc.sendRequest("login",g,e,h,p)}}function y(L,J){if(AWL.inUse_Version==="10.0"){if(J.responseCode==="200"){AWL.console.debug("evtLoginStatusHandler - Registration successfull");if(AWL.serviceType===CONST.RELAYSERVICE){n=true;var K=J.responseString.split(" ")[1];console.log("UID for this session : "+K);if(K!==""){t=K}AWL.onRegistrationStateChange.notify({result:CONST.AWL_MSG_LOGIN_SUCCESS,reason:"SIP registration success",UID:K})}else{n=true;AWL.onRegistrationStateChange.notify({result:CONST.AWL_MSG_LOGIN_SUCCESS,reason:"SIP registration success"})}}else{AWL.console.debug("evtLoginStatusHandler - Registration Failed");D({result:CONST.AWL_MSG_LOGIN_FAILED,reason:J.responseString})}}else{J=L;if(J[0]){AWL.console.debug("evtLoginStatusHandler - Registration successfull");n=true;AWL.onRegistrationStateChange.notify({result:CONST.AWL_MSG_LOGIN_SUCCESS,reason:"SIP registration success"})}else{AWL.console.debug("evtLoginStatusHandler - Registration Failed");D({result:CONST.AWL_MSG_LOGIN_FAILED,reason:J[1]})}}}function z(K,J){if(J.loginState==="LOGGED_OUT"){AWL.console.debug("evtLoginStatusEventHandler - Logged out forcefully");D({result:CONST.AWL_MSG_LOGIN_FAILED,reason:J.reasonString})}else{AWL.console.debug("evtLoginStatusEventHandler - Relogged in automatically")}}function x(K,J){if((J.responseCode==="200")){D()}}function G(K,J){if(AWL.inUse_Version==="10.0"){if(J.responseCode==="200"){AWL.console.debug("gatewaySettingsResponseHandler: Success");H(J)}else{AWL.console.error("gatewaySettingsResponseHandler: "+J.responseString)}}else{J=K;if(J[0]!=null){AWL.console.debug("gatewaySettingsResponseHandler: Success");H(J[0])}else{AWL.console.error("gatewaySettingsResponseHandler: Failed to get the requested settings")}}}function H(J){if(J.codec!=null){AWL.dtmfPayLoadType=J.codec.dtmfPayLoad;AWL.console.log("DTMF Payload:"+AWL.dtmfPayLoadType)}if(J.nat!=null){k={url:"stun:"+J.nat.stun.serverAddr+":"+J.nat.stun.serverPort};AWL.console.log("Stun details : "+JSON.stringify(k,null,2));d={ip:J.nat.turn.serverAddr,port:J.nat.turn.serverPort,user:J.nat.turn.username};AWL.console.log("Turn details : "+JSON.stringify(d,null,2));d.pwd=J.nat.turn.password;if(J.nat.turn.enforce.toLowerCase()==="true"){b=true}else{b=false}AWL.console.log("Enforce Turn : "+b)}if(J.other!=null){m=J.other.gatewayVersion;AWL.console.log("Gateway Version :"+m);o=J.other.dscp;AWL.console.log("DSCP :"+o)}}function A(K,J){if(AWL.inUse_Version==="10.0"){if(J){AWL.console.debug("gatewaySettingsChangedHandler: Success");H(J)}else{AWL.console.error("gatewaySettingsChangedHandler: Failed to get the gateway settings")}}else{J=K;if(J[0]!=null){AWL.console.debug("gatewaySettingsChangedHandler: Success");H(J[0])}else{AWL.console.error("gatewaySettingsChangedHandler: Failed to get the gateway settings")}}}function I(){if(AWL.jsonRpc){if(AWL.inUse_Version==="9.1"){AWL.jsonRpc.detach(AWL.serviceType,AWL.callmanager_9_1version.getInstance().incomingCallHandler);AWL.jsonRpc.detach(AWL.serviceType,AWL.callmanager_9_1version.getInstance().callStateHandler);AWL.jsonRpc.detach(AWL.serviceType,AWL.callmanager_9_1version.getInstance().mediaAnswerHandler);AWL.jsonRpc.detach(AWL.serviceType,AWL.callmanager_9_1version.getInstance().callUpdateHandler);AWL.jsonRpc.detach(AWL.serviceType,y);AWL.jsonRpc.detach(AWL.serviceType,A);AWL.jsonRpc.detach(AWL.serviceType,G);if(AWL.serviceType===CONST.AGENTSERVICE){AWL.jsonRpc.detach(AWL.serviceType,AWL.callmanager_9_1version.getInstance().callControllerHandler)}}else{if((AWL.serviceType===CONST.PHONESERVICE)||(AWL.serviceType===CONST.AGENTSERVICE)){AWL.jsonRpc.detach("login");AWL.jsonRpc.detach("logout");AWL.jsonRpc.detach("LoginStatusChanged");AWL.jsonRpc.detach("IncomingCall");AWL.jsonRpc.detach("makeCall");AWL.jsonRpc.detach("transferCall");AWL.jsonRpc.detach("answerCall");AWL.jsonRpc.detach("CallProgressing");AWL.jsonRpc.detach("rejectCall");AWL.jsonRpc.detach("abortCall");AWL.jsonRpc.detach("endCall");AWL.jsonRpc.detach("holdCall");AWL.jsonRpc.detach("unholdCall");AWL.jsonRpc.detach("CallDisconnected");AWL.jsonRpc.detach("CallHeld");AWL.jsonRpc.detach("CallUnheld");AWL.jsonRpc.detach("CallConnected");AWL.jsonRpc.detach("CallTransferSuccessful");AWL.jsonRpc.detach("CallTransferFailed");AWL.jsonRpc.detach("CallCtiEventReceived");AWL.jsonRpc.detach("FarEndChanged");AWL.jsonRpc.detach("getGatewaySettings");AWL.jsonRpc.detach("GatewaySettingsChanged")}}AWL.jsonRpc=null}}function B(){AWL.connectionmanager.getInstance().destroyWebsocketConnection()}function F(){if(v===null){window.AudioContext=window.AudioContext||window.webkitAudioContext;v=new AudioContext();var J=document.getElementById(AWL.configuration.getInstance().getDomElements().relayAudioTagId);_audioSource=v.createMediaElementSource(J);l=v.createMediaStreamDestination();_audioSource.connect(l)}return l.stream}function w(){AWL.callmanager.getInstance().cleanUpCallsIfRequired("GW connection lost");I();B();if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var J=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaReset(J)}n=false;AWL.muteAllStreams=false;j=true;f._logIn(g,e)}return{logIn:_logIn,logOut:_logOut,isloggedIn:_isloggedIn,playStream:_playStream,stopStream:_stopStream,evtWebSocketConnectionOpenHandler:_evtWebSocketConnectionOpenHandler,evtWebSocketConnectionCloseHandler:_evtWebSocketConnectionCloseHandler}};return{getInstance:function(){if(!q){q=a()}return q}}})();AWL.namespace("call.utility");AWL.call.utility=(function(){var a;var b=function(){this._getNewCallId=function(c){var d=Math.floor((Math.random()*2000)+1);d=CryptoJS.MD5(c+d);AWL.console.debug("\nRandom: "+d);return""+d+"@"+location.hostname};this._createAudioTag=function(d){var c=document.createElement("audio");c.id=d;c.autoplay=true;document.body.appendChild(c)};return{getNewCallId:_getNewCallId,createAudioTag:_createAudioTag}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("clientCallObj");AWL.clientCallObj=function(l){var c=l;var b=function(){return c.getCallID()};var g=function(){return c.getCallState()};var k=function(){return c.getFarEndNumber()};var d=function(){return c.getFarEndName()};var j=function(){return c.getSipUri()};var h=function(){return c.isAutoAnswer()};var a=function(){return c.isVideoCall()};var e=function(){return c.getLocalStream()};var f=function(){return c.getRemoteStream()};return{getCallId:b,getCallState:g,getFarEndNumber:k,getFarEndName:d,getSipUri:j,isAutoAnswer:h,isVideoCall:a,getLocalStream:e,getRemoteStream:f}};AWL.namespace("devicemanager");AWL.devicemanager=(function(){var a;var b=function(){var c=function(){AWL.console.debug("devicemanager : getDeviceInfo");if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices){AWL.console.log("enumerateDevices() not supported.");return}var e=[];navigator.mediaDevices.enumerateDevices().then(function(f){f.forEach(function(g){e.push([g.kind,g.label,g.deviceId])});AWL.onDeviceListRequested.notify(e)})};var d=function(g,h){var f=g;AWL.console.debug("devicemanager : getUserMedia :: callType : "+h);if(h==="videoOnly"){if(AWL.configuration.getInstance().getDeviceIds().videoInputID){AWL.console.debug("devicemanager : getUserMedia :: acquiring video device of Id "+AWL.configuration.getInstance().getDeviceIds().videoInputID);var e={video:{optional:[{minFrameRate:15},{maxWidth:352},{maxHeight:288},{sourceId:AWL.configuration.getInstance().getDeviceIds().videoInputID}]}}}else{AWL.console.debug("devicemanager : getUserMedia :: acquiring default video device");var e={video:{optional:[{minFrameRate:15},{maxWidth:352},{maxHeight:288}]}}}}else{if(AWL.configuration.getInstance().getDeviceIds().audioInputID){AWL.console.debug("devicemanager : getUserMedia :: acquiring audio device of Id "+AWL.configuration.getInstance().getDeviceIds().audioInputID);if(navigator.webkitGetUserMedia){var e={audio:{optional:[{sourceId:AWL.configuration.getInstance().getDeviceIds().audioInputID}]}}}else{var e={audio:{deviceId:AWL.configuration.getInstance().getDeviceIds().audioInputID?{exact:AWL.configuration.getInstance().getDeviceIds().audioInputID}:undefined}}}}else{AWL.console.debug("devicemanager : getUserMedia :: acquiring default audio device");var e={audio:true}}if(AWL.configuration.getInstance().getConfiguration().enableVideo&&h==="video"){if(AWL.configuration.getInstance().getDeviceIds().videoInputID){AWL.console.debug("devicemanager : getUserMedia :: acquiring video device of Id "+AWL.configuration.getInstance().getDeviceIds().videoInputID);if(navigator.webkitGetUserMedia){e.video={optional:[{minFrameRate:15},{maxWidth:352},{maxHeight:288},{sourceId:AWL.configuration.getInstance().getDeviceIds().videoInputID}]}}else{e.video={deviceId:AWL.configuration.getInstance().getDeviceIds().videoInputID?{exact:AWL.configuration.getInstance().getDeviceIds().videoInputID}:undefined}}}else{AWL.console.debug("devicemanager : getUserMedia :: acquiring default video device");e.video={optional:[{minFrameRate:15},{maxWidth:352},{maxHeight:288}]}}}}AWL.webrtc.getUserMedia(e,f.evtMediaDeviceAccessAcquired,f.evtMediaDeviceAccessFailed)};return{getUserMedia:d,getDeviceInfo:c}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("connectionmanager");AWL.connectionmanager=(function(){var a;var c=null;var b=function(){var d=function(j,f,h){if(h!==null){c=h;AWL.console.debug("connectionmanager : createWebsocketConnection");var g="wss://"+j+":"+f+"/SignalGateway/connect";AWL.wsConnection=new AWL.io.WebSocketConnection("jsonrpc");AWL.wsConnection.evtConnectionClose.attach(c.evtWebSocketConnectionCloseHandler);AWL.wsConnection.evtConnectionOpen.attach(c.evtWebSocketConnectionOpenHandler);AWL.wsConnection.open(g)}};var e=function(){AWL.console.debug("connectionmanager : destroyWebsocketConnection");if(AWL.wsConnection){AWL.wsConnection.evtConnectionClose.detach(c.evtWebSocketConnectionCloseHandler);AWL.wsConnection.evtConnectionOpen.detach(c.evtWebSocketConnectionOpenHandler);AWL.wsConnection.close();AWL.wsConnection=null}c=null};return{createWebsocketConnection:d,destroyWebsocketConnection:e}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.loopBack=AWL.namespace("loopBack");AWL.loopBack=(function(){var a;var b=function(){var K="";var s="";var w=null;var k=null;var V={};var O=null;var u=[];var n=null;var T="";var e=new Array();var J=new Array();var S={};var l=0,v=0,d=0,R=0,f=0,M=0,m=0,c=0,q=null;var F=false;var I=false;var y=false;var H=false;var t=false;var P=null;var o=function(W){K=W};this._setLocalStream=function(W){P=W};var B=function(){if(!H){u=new Object();AWL.clientAPIConsole.debug("\nloopBack :: createLoopBackConnection");AWL.registration.getInstance().playStream();if((((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0)&&(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0)){V.iceServers=[AWL.configuration.getInstance().getStunServerURL(),AWL.configuration.getInstance().getTurnServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0){V.iceServers=[AWL.configuration.getInstance().getStunServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0){V.iceServers=[AWL.configuration.getInstance().getTurnServerURL()]}else{V.iceServers=[]}}}s="0";o(AWL.call.utility.getInstance().getNewCallId(s));w=new AWL.webrtc.PeerConnection();w.evtRemoteStream.attach(h);w.evtLocalCandidates.attach(r);w.evtLocalDescription.attach(D);w.init({rtcConfiguration:V,constraints:{optional:[{DtlsSrtpKeyAgreement:true}]}});w.addStream(P);H=true;t=false;w.createOffer(function(W){AWL.console.error("loopBack: createOffer failed: "+W)},{optional:[{MozDontOfferDataChannel:true}]})}else{AWL.console.debug("Duplicate loopback connection request: ignored")}};var G=function(){AWL.clientAPIConsole.debug("\nloopBack :: answerCall");if((((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0)&&(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0)){V.iceServers=[AWL.configuration.getInstance().getStunServerURL(),AWL.configuration.getInstance().getTurnServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0){V.iceServers=[AWL.configuration.getInstance().getStunServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0){V.iceServers=[AWL.configuration.getInstance().getTurnServerURL()]}else{V.iceServers=[]}}}k=new AWL.webrtc.PeerConnection();k.evtRemoteStream.attach(h);k.evtICEConnectivity.attach(A);k.evtLocalCandidates.attach(r);k.evtLocalDescription.attach(D);k.init({rtcConfiguration:V,constraints:{optional:[{DtlsSrtpKeyAgreement:true}]}});k.addStream(P);var W={sdp:O,type:"offer"};k.setRemoteDescription(W,function(X){AWL.console.error("setRemoteDescriptionErrorHandler: "+X)},{optional:[{MozDontOfferDataChannel:true}]})};var C=function(){if(H){t=true;AWL.clientAPIConsole.debug("loopBack :: endLoopBackConnection");if(AWL.jsonRpc!==null){AWL.jsonRpc.sendRequest("endCall",K)}}};var Q=function(){AWL.clientAPIConsole.debug("loopBack :: getLoopBackStats");if(w!==null){if(navigator.mozGetUserMedia){AWL.console.error("loopBack :: getLoopBackStats not supported in firefox")}else{n=setInterval(function(){w.getStats(function(Z){var Y=Z.result();for(var X=0;X<Y.length;X++){var W=Y[X];if(!W.local||W.local==W){U(W)}}},L);k.getStats(function(Z){var Y=Z.result();for(var X=0;X<Y.length;X++){var W=Y[X];if(!W.local||W.local==W){x(W)}}},L)},2000)}}};var E=function(){AWL.clientAPIConsole.debug("loopBack :: collectLoopBackStats");if(navigator.mozGetUserMedia){return null}else{var W=[];W.audio=u;return W}};var N=function(X){AWL.console.debug("\nloopBack :: resetCall");O=null;s="";T="";if(w){w.close();w=null}if(k){k.close();k=null}AWL.registration.getInstance().stopStream();var W=document.getElementById(K);if(W!=null){AWL.webrtc.mediaReset(W);document.body.removeChild(W)}if(n!==null){clearInterval(n);n=null;l=0;R=0;f=0;q=null;M=0;v=0;d=0;m=0;c=0;I=false;y=false;F=false}if(H){H=false;if(t||X==="clean up: tearing down the call forcefully"){AWL.onLoopBackNotification.notify({notification:CONST.AWL_MSG_LOOPBACK_CONN_CLOSED})}else{AWL.onLoopBackNotification.notify({notification:CONST.AWL_MSG_LOOPBACK_CONN_FAILED})}}};var j=function(X,W){AWL.console.debug("loopback: callStateHandler: msg: "+X+" Params: "+W);if(X==="CallDisconnected"){N(W.reasonString)}else{if(X==="CallProgressing"){}else{}}};var z=function(aa,Z){if((aa==="CallConnected")&&Z){if(Z.sdp){var W=Z.sdp;AWL.console.debug("Answer: \n"+W);var X={sdp:W,type:"answer"};w.setRemoteDescription(X,function(ab){AWL.console.error("setRemoteDescriptionErrorHandler: "+ab)})}P.getAudioTracks().forEach(function(ab){S[ab.id]=ab.kind});for(var Y in S){if(S[Y]==="audio"){T=Y;AWL.console.debug("audioTrackKey = "+T)}}}};var g=function(X,W){AWL.console.debug("loopback :: incomingCallHandler ");if(W){s=W.FarEndDn;O=W.sdp;G(K)}};var p=function(X,W){};function h(X,W){AWL.console.debug("evtRemoteStreamHandler: "+W.type);if(W.type==="audio"){AWL.call.utility.getInstance().createAudioTag(K);rmtAud=document.getElementById(K);AWL.webrtc.mediaSetStream(rmtAud,W.stream)}}function D(X,W){AWL.console.debug("evtLocalDescriptionHandler");if(O){AWL.console.debug("Answer: \n"+W.sdp);AWL.jsonRpc.sendRequest("answerCall",K,W.sdp)}else{AWL.console.debug("Offer: \n"+W.sdp);AWL.jsonRpc.sendRequest("makeCall",s,K,W.sdp)}}function r(X,W){AWL.console.debug("evtLocalCandidatesHandler: "+W)}function U(ab){if(ab.names){var aa=ab.names();for(var Y=0;Y<aa.length;Y++){var X=aa[Y];var Z=ab.stat(X);if(!I){if(X==="googLocalAddress"){u.localAddress=Z;I=true}}if(!y){if(X==="googRemoteAddress"){u.remoteAddress=Z;y=true}}if(X==="googTrackId"&&Z===T){for(var Y=0;Y<aa.length;Y++){var X=aa[Y];var Z=ab.stat(X);if(X==="googJitterReceived"){u.totJitter=Z}if(X==="packetsSent"){u.totPSent=Z;AWL.console.debug("_statsArrayChrome[totPSent] = "+Z);d=Z;f=d-R;AWL.console.debug("_statsArrayChrome[nowPSent] = "+f);R=Z}if(X==="packetsLost"){u.totPLost=Z;v=Z;var W=v-l;u.nowPLoss=W;AWL.console.debug("_statsArrayChrome[nowPLoss] = "+W);l=Z;if(d>0){u.totPLossPercent=((v/d)*100).toFixed(2)}if(f>0){if(q===0){AWL.console.warn("100% packet loss");u.nowPLossPercent=100;AWL.console.debug("_ignoreCompletePLoss : true ");F=true}else{if(!F){if(W>f){W=0}u.nowPLossPercent=((W/f)*100)}else{if(W!==0){u.nowPLossPercent=0}else{if(W>f){W=0}u.nowPLossPercent=((W/f)*100);F=false;AWL.console.debug("_ignoreCompletePLoss : false ")}}}}AWL.console.debug("_statsArrayChrome[nowPLossPercent] :  "+u.nowPLossPercent)}if(X==="googRtt"){Z=Z/1000;if(Z>0){if(u.nowPLossPercent!==100){u.nowRTT=Z}else{u.nowRTT=null;Z=null}}else{u.nowRTT=null;Z=null}if(Z!==null){M=M+Z;J.push(Z)}u.minRTT=Math.min.apply(Math,J);u.maxRTT=Math.max.apply(Math,J);u.avgRTT=(M/J.length).toFixed(2);AWL.console.debug("_statsArrayChrome: avgRTT="+u.avgRTT)}}}}}}function x(aa){if(aa.names){var Z=aa.names();for(var X=0;X<Z.length;X++){var W=Z[X];var Y=aa.stat(W);if(W==="packetsReceived"){u.totPReceived=Y;AWL.console.debug("_statsArrayChrome[totPReceived] = "+Y);m=Y;q=m-c;AWL.console.debug("_statsArrayChrome[nowPRecv] = "+q);c=Y;if(q===0){AWL.console.warn("No Packets received, possibly packet loss")}}}}}function A(X,W){AWL.console.debug("evtICEConnectivityHandler: "+W.iceStatus);if(W.iceStatus==="connected"){AWL.onLoopBackNotification.notify({notification:CONST.AWL_MSG_LOOPBACK_CONN_SUCCESSFULL})}else{if(W.iceStatus==="disconnected"){if(!t){u.nowPLossPercent=100;u.nowRTT=null;AWL.onLoopBackNotification.notify({notification:CONST.AWL_MSG_LOOPBACK_CONN_LINK_ISSUE})}}else{if(W.iceStatus==="failed"){if(!t){AWL.onLoopBackNotification.notify({notification:CONST.AWL_MSG_LOOPBACK_CONN_FAILED})}}}}}function L(){AWL.console.debug("notifyStatsError : stats failure");AWL.onLoopBackNotification.notify({notification:CONST.AWL_MSG_LOOPBACK_STATS_FAILURE})}return{incomingCallHandler:g,callStateHandler:j,mediaAnswerHandler:z,callUpdateHandler:p,createLoopBackConnection:B,endLoopBackConnection:C,getLoopBackStats:Q,collectLoopBackStats:E,resetCall:N,answerCall:G,setLocalStream:_setLocalStream}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("callmanager");AWL.callmanager=(function(){var a;var b=function(){var D="",w="",v="";var n=null;var h=function(K,J){AWL.console.debug("callmanager : incomingCallHandler");if(AWL.totalCalls==2){AWL.console.debug("callmanager : Max Call Limit Reached");D.rejectCall()}if(J){w=J.callId;D=p(w);D.inComingCallHandler(J)}else{AWL.console.error("callmanager : Ignoring incoming call as there is no params")}};var m=function(K,J){AWL.console.debug("callmanager: callStateHandler: msg: "+K+" Params: "+J);if(J){if(J.callId){w=J.callId;D=AWL.callMap[w];if(D){D.callStateHandler(K,J)}else{AWL.console.error("callmanager : callObj not defined for callId: "+w)}}}else{AWL.console.error("callmanager : Ignoring callStateHandler events as there is no params")}};var G=function(K,J){AWL.console.debug("callmanager: callProgressHandler");if(J){if(J.callId){w=J.callId;D=AWL.callMap[w];if(D){D.callProgressHandler(K,J)}else{AWL.console.error("callmanager: couldn't find the call object for call-id: "+w)}}}};var C=function(K,J){AWL.console.debug("callmanager : mediaAnswerHandler");if(J){if(J.callId){w=J.callId;D=AWL.callMap[w];if(D){D.mediaAnswerHandler(K,J)}else{AWL.console.error("callmanager : callObj not defined for callId: "+w)}}}else{AWL.console.error("callmanager : Ignoring mediaAnswerHandler as there is no params")}};var o=function(K,J){AWL.console.debug("callUpdateHandler: msgName: "+K+" Params: "+J);if(J){if(J.callId){w=J.callId;D=AWL.callMap[w];D.callUpdateHandler(K,J)}}else{AWL.console.error("callmanager : Ignoring callUpdateHandler as there is no params")}};var I=function(K,J){AWL.console.debug("callmanager : callControllerHandler");if(J){if(J.callId){w=J.callId;D=AWL.callMap[w];D.callControllerHandler(K,J)}}else{AWL.console.error("callmanager : Ignoring callControllerHandler as there is no params")}};var k=function(K,J){AWL.console.debug("callmanager : mediaUpdateHandler");if(J){if(J.callId){w=J.callId;D=AWL.callMap[w];if(D){D.mediaUpdateHandler(K,J)}else{AWL.console.error("callmanager: Ignoring mediaUpdateHandler as callObj not available for callId: "+w)}}}else{AWL.console.error("callmanager : Ignoring mediaUpdateHandler as there is no params")}};function p(J){D=new AWL.callsession();D.setCallID(J);AWL.callMap[D.getCallID()]=D;return D}var H=function(){for(var J in AWL.callMap){D=AWL.callMap[J];if(D.isCallActive()){D.doHold()}}};var z=function(K){for(var J in AWL.callMap){D=AWL.callMap[J];if((D.getCallState()!==CONST.AWL_MSG_CALL_IDLE)&&(D.getCallState()!==CONST.AWL_MSG_CALL_DISCONNECTED)){D.resetCall(K)}}};var A=function(J,K){if(Object.keys(AWL.callMap).length&&Object.keys(AWL.callMap).length>0){H()}D=new AWL.callsession();D.setCallID(AWL.call.utility.getInstance().getNewCallId(J));v=new AWL.clientCallObj(D);AWL.callMap[D.getCallID()]=D;B(D,J,K);return v};var B=function(L,M,N){var J=true;for(var K in AWL.callMap){D=AWL.callMap[K];if(L.getCallID()===K||D.getCallState()===CONST.AWL_MSG_CALL_HELD){J=true}else{J=false;break}}if(!J){if(n!==null){clearTimeout(n);n=null}AWL.console.debug("callmanager :: All calls are not in Held State");n=setTimeout(function(){B(L,M,N)},100)}else{if(n!==null){clearTimeout(n);n=null}AWL.console.debug("callmanager :: All calls are in Held State");AWL.console.debug("\ncallmanager :: makeCall");if(typeof(M)==="undefined"){M=0}L.makeCall(M,N,v)}};var j=function(L,K,J){AWL.console.debug("\ncallmanager :: _transferCall");if(typeof(AWL.callMap[K])!=="undefined"){D=AWL.callMap[K];D.transferCall(L,K,J)}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in transferCall API is incorrect! - call not transfered")}};var c=function(J){AWL.console.debug("\ncallmanager :: answerCall");if(typeof(AWL.callMap[J])!=="undefined"){H();F(J)}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in answerCall API is incorrect! - call not answered")}};var F=function(L){var J=true;for(var K in AWL.callMap){D=AWL.callMap[K];if(L===K||D.getCallState()===CONST.AWL_MSG_CALL_HELD||D.getCallState()===CONST.AWL_MSG_CALL_INCOMING){J=true}else{J=false;break}}if(!J){if(n!==null){clearTimeout(n);n=null}n=setTimeout(function(){F(L)},100)}else{if(n!==null){clearTimeout(n);n=null}D=AWL.callMap[L];if(D.getCallState()===CONST.AWL_MSG_CALL_INCOMING){D.answerCall()}}};var g=function(J){AWL.console.debug("\ncallmanager :: rejectCall");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.rejectCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in rejectCall API is incorrect! - call not rejected")}};var t=function(J){AWL.console.debug("\ncallmanager :: dropCall");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.dropCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in dropCall API is incorrect! - call not dropped")}};var d=function(J){AWL.console.debug("\ncallmanager :: cancelCall");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.cancelCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in cancelCall API is incorrect! - call not cancelled")}};var y=function(J){AWL.console.debug("\ncallmanager :: doHold");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.doHold()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doHold API is incorrect! - call not held")}};var l=function(J){AWL.console.debug("\ncallmanager :: doUnHold");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.doUnHold()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doUnHold API is incorrect! - call not unheld")}};var s=function(J){AWL.console.debug("\ncallmanager :: doMute");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];return(D.doMute())}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doMute API is incorrect! - mic not muted");return false}};var e=function(J){AWL.console.debug("\ncallmanager :: doUnMute");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];return(D.doUnMute())}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doUnMute API is incorrect! - mic not unmuted");return false}};var f=function(J){AWL.console.debug("\ncallmanager :: pauseVideo");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];return(D.pauseVideo())}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in pauseVideo API is incorrect! - video not paused");return false}};var x=function(J){AWL.console.debug("\ncallmanager :: playVideo");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];return(D.playVideo())}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in playVideo API is incorrect! - video not resumed");return false}};var r=function(J,K){AWL.console.debug("\ncallmanager :: sendDTMF");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.sendDTMF(K)}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in sendDTMF API is incorrect! - DTMF not sent")}};var q=function(J){AWL.console.debug("\ncallmanager :: getStats");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.getstats();return D.collectStats()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in getStats API is incorrect! - getStats not called")}};var E=function(J){AWL.console.debug("\ncallmanager :: addVideo");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.addVideo()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in addVideo API is incorrect! - addVideo not done")}};var u=function(J){AWL.console.debug("\ncallmanager :: removeVideo");if(typeof(AWL.callMap[J])!=="undefined"){D=AWL.callMap[J];D.removeVideo()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in removeVideo API is incorrect! - removeVideo not done")}};return{incomingCallHandler:h,callStateHandler:m,callProgressHandler:G,mediaAnswerHandler:C,autoHoldIfRequired:H,callUpdateHandler:o,callControllerHandler:I,mediaUpdateHandler:k,cleanUpCallsIfRequired:z,makeCall:A,answerCall:c,rejectCall:g,dropCall:t,cancelCall:d,doHold:y,doUnHold:l,doMute:s,doUnMute:e,pauseVideo:f,playVideo:x,sendDTMF:r,transferCall:j,getStats:q,addVideo:E,removeVideo:u}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("callmanager_9_1version");AWL.callmanager_9_1version=(function(){var a;var b=function(){var v="",q="",p="";var f=function(y){AWL.console.debug("callmanager_9_1version : incomingCallHandler");q=y[2];v=l(q);v.inComingCallHandler(y)};var j=function(y){AWL.console.debug("callmanager_9_1version: callStateHandler: State: "+y[0]+" Param: "+y[1]);q=y[2];v=AWL.callMap[q];if(typeof(v)!=="undefined"){v.callStateHandler(y)}else{AWL.console.error("callmanager_9_1version : callObj not available for callId: "+q)}};var u=function(y){AWL.console.debug("callmanager_9_1version : mediaAnswerHandler");q=y[1];v=AWL.callMap[q];if(typeof(v)!=="undefined"){v.mediaAnswerHandler(y)}else{AWL.console.error("callmanager_9_1version : callObj not available for callId: "+q)}};var k=function(y){AWL.console.debug("callUpdateHandler: Type: "+y[0]+" Param: "+y[1]);if(y[0]==="displayupdate"){q=y[2];v=AWL.callMap[q];if(typeof(v)!=="undefined"){v.callUpdateHandler(y)}else{AWL.console.error("callmanager_9_1version : callObj not available for callId: "+q)}}};var x=function(y){AWL.console.debug("callmanager_9_1version : callControllerHandler");q=y[0];v=AWL.callMap[q];if(typeof(v)!=="undefined"){v.callControllerHandler(y)}else{AWL.console.error("callmanager_9_1version : callObj not available for callId: "+q)}};function l(y){v=new AWL.callsession_9_1version();v.setCallID(y);AWL.callMap[v.getCallID()]=v;return v}var w=function(){for(var y in AWL.callMap){v=AWL.callMap[y];if(v.isCallActive()){v.doHold()}}};var s=function(z){for(var y in AWL.callMap){v=AWL.callMap[y];if((v.getCallState()!==CONST.AWL_MSG_CALL_IDLE)&&(v.getCallState()!==CONST.AWL_MSG_CALL_DISCONNECTED)){v.resetCall(z)}}};var t=function(y,z){AWL.console.debug("\ncallmanager_9_1version :: makeCall");v=new AWL.callsession_9_1version();if(typeof(y)==="undefined"){y=0}v.setCallID(AWL.call.utility.getInstance().getNewCallId(y));p=new AWL.clientCallObj(v);AWL.callMap[v.getCallID()]=v;v.makeCall(y,z,p);return p};var c=function(y){AWL.console.debug("\ncallmanager_9_1version :: answerCall");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.answerCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in answerCall API is incorrect! - call not answered")}};var g=function(y){AWL.console.debug("\ncallmanager_9_1version :: rejectCall");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.rejectCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in rejectCall API is incorrect! - call not rejected")}};var o=function(y){AWL.console.debug("\ncallmanager_9_1version :: dropCall");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.dropCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in dropCall API is incorrect! - call not dropped")}};var d=function(y){AWL.console.debug("\ncallmanager_9_1version :: cancelCall");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.cancelCall()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in cancelCall API is incorrect! - call not cancelled")}};var r=function(y){AWL.console.debug("\ncallmanager_9_1version :: doHold");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.doHold()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doHold API is incorrect! - call not held")}};var h=function(y){AWL.console.debug("\ncallmanager_9_1version :: doUnHold");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.doUnHold()}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doUnHold API is incorrect! - call not unheld")}};var n=function(y){AWL.console.debug("\ncallmanager_9_1version :: doMute");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];return(v.doMute())}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doMute API is incorrect! - mic not muted");return false}};var e=function(y){AWL.console.debug("\ncallmanager_9_1version :: doUnMute");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];return(v.doUnMute())}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in doUnMute API is incorrect! - mic not unmuted");return false}};var m=function(y,z){AWL.console.debug("\ncallmanager_9_1version :: sendDTMF");if(typeof(AWL.callMap[y])!=="undefined"){v=AWL.callMap[y];v.sendDTMF(z)}else{AWL.clientAPIConsole.error("\nClient Api :: CallId passed in sendDTMF API is incorrect! - DTMF not sent")}};return{incomingCallHandler:f,callStateHandler:j,mediaAnswerHandler:u,autoHoldIfRequired:w,callUpdateHandler:k,callControllerHandler:x,cleanUpCallsIfRequired:s,makeCall:t,answerCall:c,rejectCall:g,dropCall:o,cancelCall:d,doHold:r,doUnHold:h,doMute:n,doUnMute:e,sendDTMF:m}};return{getInstance:function(){if(!a){a=b()}return a}}})();AWL.namespace("callsession");AWL.callsession=function(){var a=function(){var O=this;var z="";var ac=null;var aw="";var al="";var Q="";var aj=null;var u=false;var l=null;var q=false;var ak={};var ao=false;var au=false;var m="";var o=null;var V=null;var N=false;var y="";var Y=CONST.AWL_MSG_CALL_IDLE;var t="";var Z=false;var ag=new Object();var R=new Object();var av=new Object();var b=null;var ar="";var W="";var k={};var G=false;var K=false;var ai=null;var ax=null;var D=false;var ae=null;var f=false;var r=[];var L={answerCall:"answerCallResponse",holdCall:"holdCallResponse",unholdCall:"unholdCallResponse",transferCall:"transferCallResponse",abortCall:"abortCallResponse",endCall:"endCallResponse"};var am=null;var aa="";var j=false;var s=false;var ap=null;var I=null;var ay=null;var S=null;var F=false;var B=false;var n=false;var at=false;this.setCallID=function(aA){z=aA};this.getCallID=function(){return z};this.getCallState=function(){return Y};this.getFarEndNumber=function(){return aw};this.getFarEndName=function(){return al};this.getSipUri=function(){return Q};this.isAutoAnswer=function(){return Z};this.isVideoCall=function(){return u};this.getLocalStream=function(){if(l!==null){return ac}else{AWL.clientAPIConsole.debug("\ncallsession :: getLocalStream is null, since it is a Audio Call");return null}};this.getRemoteStream=function(){return am};this.makeCall=function(aA,aC,aB){AWL.clientAPIConsole.debug("\ncallsession :: makeCall");t=aB;aw=aA;aa=aC;if(((aw).trim()).length===0){return}j=true;AWL.devicemanager.getInstance().getUserMedia(AWL.callMap[z],aa)};this.addVideo=function(){AWL.clientAPIConsole.debug("\ncallsession :: addVideo");if(!N){AWL.clientAPIConsole.warn("\ncallsession :: addVideo failed - call not active");return false}if(!u){if(AWL.configuration.getInstance().getConfiguration().enableVideo){u=true}else{AWL.clientAPIConsole.warn("\ncallsession :: addVideo failed - Video configuration disabled");return false}}else{AWL.clientAPIConsole.warn("\ncallsession :: addVideo failed - already on video call");return false}aq();if(!s){A("callUpgrade")}};function aq(){if(navigator.webkitGetUserMedia){if(l!==null){if(q){if(l.length!==0){AWL.console.debug("callsession: Add available videoTracks");for(i=0;i<l.length;i++){ac.addTrack(l[i]);AWL.console.debug("Video Tracks Id: "+l[i].id)}q=false}}else{AWL.clientAPIConsole.error("callsession: Already on a video call")}}else{AWL.devicemanager.getInstance().getUserMedia(AWL.callMap[z],"videoOnly");s=true}}else{if(az()){if(l!==null){if(AWL.remVideo){if(l.length!==0){AWL.console.debug("callsession: Add available videoTracks");for(i=0;i<l.length;i++){ac.addTrack(l[i]);AWL.console.debug("Video Tracks Id: "+l[i].id)}AWL.remVideo=false}}else{AWL.clientAPIConsole.error("callsession: Already on a video call")}}else{AWL.devicemanager.getInstance().getUserMedia(AWL.callMap[z],"videoOnly");s=true}}}}this.removeVideo=function(){AWL.clientAPIConsole.debug("\ncallsession :: removeVideo");if(!N){AWL.clientAPIConsole.warn("\ncallsession :: removeVideo failed - call not active");return false}if(u){u=false}else{AWL.clientAPIConsole.warn("\ncallsession :: removeVideo failed - already on audio call");return false}p();A("callDowngrade")};function p(){if(navigator.webkitGetUserMedia){if(l!==null){if(!q){if(l.length!==0){AWL.console.debug("callsession: Remove available local videoTracks");for(i=0;i<l.length;i++){ac.removeTrack(l[i])}q=true}}}}else{if(az()){if(l!==null){if(!AWL.remVideo){if(l.length!==0){AWL.console.debug("callsession: Remove available local videoTracks");for(i=0;i<l.length;i++){ac.removeTrack(l[i])}AWL.remVideo=true}}}}}}function A(aA){if(ax.indexOf("m=video")===-1){var aB={mandatory:{iceRestart:false}};aj.addStream(ac);G=true;aj.createOffer(function(aC){AWL.console.error("callsession: createOffer failed: "+aC);G=false},aB)}else{if(aA==="callUpgrade"){aj.setCustomLocalDescription("addVideo",y,ax);setTimeout(function(){object=aj.getCustomLocalDescription("addVideo");AWL.jsonRpc.sendRequest("updateMedia",z,object.sdp)},500);G=true}else{aj.setCustomLocalDescription("removeVideo",y,ax);setTimeout(function(){object=aj.getCustomLocalDescription("remVideo");AWL.jsonRpc.sendRequest("updateMedia",z,object.sdp)},500);G=true}}}this.isCallActive=function(){return N};this.answerCall=function(){AWL.clientAPIConsole.debug("\ncallsession :: answerCall");if(!D){if(u){aa="video"}else{aa="audio"}j=false;AWL.devicemanager.getInstance().getUserMedia(AWL.callMap[z],aa)}else{J()}};this.transferCall=function(aC,aB,aA){AWL.clientAPIConsole.debug("\ncallsession :: transferCall :: target ::"+aC);if(U(L.transferCall)){AWL.clientAPIConsole.error("callsession : Duplicate transferCall request - ignored!");return}r[L.transferCall]=true;AWL.jsonRpc.sendRequest("transferCall",aC,aB,aA)};this.rejectCall=function(){AWL.clientAPIConsole.debug("\ncallsession :: rejectCall");AWL.jsonRpc.sendRequest("rejectCall",z);O.resetCall("Call Rejected")};this.dropCall=function(){AWL.clientAPIConsole.debug("\ncallsession :: dropCall");if(U(L.endCall)){AWL.clientAPIConsole.error("callsession : Duplicate dropCall request - ignored!");return}r[L.endCall]=true;AWL.jsonRpc.sendRequest("endCall",z);if(Y!==CONST.AWL_MSG_CALL_CONNECTED&&Y!==CONST.AWL_MSG_CALL_FAREND_UPDATE&&Y!==CONST.AWL_MSG_CALL_HELD){O.resetCall("Call Dropped")}};this.cancelCall=function(){AWL.clientAPIConsole.debug("\ncallsession :: cancelCall");if(U(L.abortCall)){AWL.clientAPIConsole.error("callsession : Duplicate cancelCall request - ignored!");return}r[L.abortCall]=true;AWL.jsonRpc.sendRequest("abortCall",z);if(Y!==CONST.AWL_MSG_CALL_CONNECTED&&Y!==CONST.AWL_MSG_CALL_FAREND_UPDATE&&Y!==CONST.AWL_MSG_CALL_HELD){O.resetCall("Call Dropped")}};this.doHold=function(){AWL.clientAPIConsole.debug("\ncallsession :: doHold");if(U(L.holdCall)){AWL.clientAPIConsole.error("callsession : Duplicate holdCall request - ignored!");return}c()};this.doUnHold=function(){AWL.clientAPIConsole.debug("\ncallsession :: doUnHold");if(U(L.unholdCall)){AWL.clientAPIConsole.error("callsession : Duplicate unholdCall request - ignored!");return}af()};this.doMute=function(){AWL.clientAPIConsole.debug("\ncallsession :: doMute");return(ab())};this.doUnMute=function(){AWL.clientAPIConsole.debug("\ncallsession :: doUnMute");return(H())};this.pauseVideo=function(){AWL.clientAPIConsole.debug("\ncallsession :: pauseVideo");if(navigator.webkitGetUserMedia){if(l!==null){if(l.length!==0){for(i=0;i<l.length;i++){l[i].enabled=false;AWL.console.debug("Video Tracks Id: "+l[i].id)}AWL.clientAPIConsole.debug("\ncallsession: local video paused");return true}}}else{if(l!==null){if(l.length!==0){if(!AWL.muteAllStreams){for(i=0;i<l.length;i++){l[i].enabled=false;AWL.console.debug("Video Tracks Id: "+_.videoTracks[i].id);AWL.videoPaused=true}AWL.clientAPIConsole.debug("\ncallsession: local video paused");return true}}}}return false};this.playVideo=function(){AWL.clientAPIConsole.debug("\ncallsession :: playVideo");if(navigator.webkitGetUserMedia){if(l!==null){if(l.length!==0){for(i=0;i<l.length;i++){l[i].enabled=true;AWL.console.debug("Video Tracks Id: "+l[i].id)}AWL.clientAPIConsole.debug("\ncallsession: local video resumed");return true}}}else{if(l!==null){if(l.length!==0){if(!AWL.muteAllStreams){for(i=0;i<l.length;i++){l[i].enabled=true;WL.console.debug("Video Tracks Id: "+l[i].id);AWL.videoPaused=false}AWL.clientAPIConsole.debug("\ncallsession: local video resumed");return true}}}}return false};this.sendDTMF=function(aC){var aB=500;var aD=50;if(ac!==null){var aA=ac.getAudioTracks()[0];o=aj.createDTMFSender(aA);if(o){if(o.canInsertDTMF){AWL.clientAPIConsole.debug("Call eligible to do DTMF");AWL.console.debug("Call eligible to do DTMF");o.insertDTMF(aC,aB,aD);o.ontonechange=C}else{AWL.console.error("\ncallsession :: Call not eligible to do dtmf")}}}};this.resetCall=function(aF){AWL.console.debug("\ncallsession :: resetCall");av="";ag="";R="";ax=null;ai=null;clearInterval(b);V=null;aw="";al="";Q="";o=null;N=false;Z=false;G=false;K=false;D=false;f=false;ae=null;y="";AWL.totalCalls--;am="";n=false;at=false;if(au){H()}if(aj){aj.close();aj=null}if(u){if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""){var aC=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);AWL.webrtc.mediaReset(aC)}else{if(ay!==null){AWL.webrtc.mediaReset(ay)}else{AWL.console.debug("resetCall: Not Detaching the remoteStreams since application is handling the Stream")}}if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var aE=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaReset(aE)}else{if(I!==null){AWL.webrtc.mediaReset(I)}else{AWL.console.debug("resetCall: Not Detaching the localStreams since application is handling the Stream")}}}if(AWL.remoteStreams[z]!==null&&typeof(AWL.remoteStreams[z])!=="undefined"){delete AWL.remoteStreams[z]}if(ac!==null&&typeof(ac)!=="undefined"){var aD=ac.getAudioTracks();for(i=0;i<aD.length;i++){aD[i].stop();AWL.console.debug("\ncallsession :: resetCall :: releasing Audio Device from this callSession")}var aA=ac.getVideoTracks();for(i=0;i<aA.length;i++){aA[i].stop();AWL.console.debug("\ncallsession :: resetCall :: releasing Video Device from this callSession")}l=null;ac=null;q=false}u=false;var aB=document.getElementById(z);if(aB!=null){AWL.webrtc.mediaReset(aB);document.body.removeChild(aB)}delete AWL.callMap[z];r=[];if(Y!==CONST.AWL_MSG_CALL_DISCONNECTED){AWL.onCallStateChange.notify(z,t,Y)}AWL.onCallTerminate.notify(t,aF)};this.callStateHandler=function(aC,aB){AWL.console.debug("callStateHandler: msgName: "+aC+" Param: "+aB);if(U(aC)){AWL.console.debug("Received pending response");delete r[aC]}if(aC==="CallDisconnected"){Y=CONST.AWL_MSG_CALL_DISCONNECTED;AWL.onCallStateChange.notify(z,t,Y);O.resetCall(aB.reasonString)}else{if(aC==="CallTransferSuccessful"){AWL.clientAPIConsole.debug("\ncallsession: call is transferred");AWL.onCallStateChange.notify(z,t,CONST.AWL_MSG_CALL_TRANSFER_SUCCESS)}else{if(aC==="CallTransferFailed"){AWL.clientAPIConsole.debug("\ncallsession: call transfer Failed");Y=CONST.AWL_MSG_CALL_TRANSFER_FAILED;AWL.onCallStateChange.notify(z,t,Y);Y=CONST.AWL_MSG_CALL_CONNECTED}else{if(aC==="CallProgressing"){Y=CONST.AWL_MSG_CALL_RINGING;AWL.onCallStateChange.notify(z,t,Y)}else{if(aC==="CallUnheld"){N=true;ao=!ao;if(navigator.mozGetUserMedia){if(!AWL.webrtc.mozRenegotiationSupport()){ad()}}if(navigator.webkitGetUserMedia||AWL.webrtc.mozRenegotiationSupport()){aj.setCustomRemoteDescription("unhold",y,ai)}if(u){var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);if(typeof(AWL.remoteStreams[z])!=="undefined"){AWL.webrtc.mediaSetStream(aA,AWL.remoteStreams[z])}else{if(ay!==null){AWL.webrtc.mediaSetStream(ay,am)}else{AWL.console.debug("callStateHandler: Not Attaching the remoteStreams since application is handling the Stream")}}}AWL.clientAPIConsole.debug("\ncallsession: call is unheld");Y=CONST.AWL_MSG_CALL_CONNECTED;AWL.onCallStateChange.notify(z,t,Y)}else{if(aC==="CallHeld"){N=false;ao=!ao;if(navigator.mozGetUserMedia){if(!AWL.webrtc.mozRenegotiationSupport()){ad()}}if(navigator.webkitGetUserMedia||AWL.webrtc.mozRenegotiationSupport()){aj.setCustomRemoteDescription("hold",y,ai)}AWL.clientAPIConsole.debug("\ncallsession: call is held");Y=CONST.AWL_MSG_CALL_HELD;AWL.onCallStateChange.notify(z,t,Y)}}}}}}};this.callProgressHandler=function(aB,aE){AWL.console.debug("callProgressHandler: "+aB);if(aE){if(aE.sdp){AWL.console.debug("CallProgressHandler: Early media received from gw");var aA=aE.sdp;AWL.console.debug("CallProgressHandler: Early media sdp: \n"+aA);var aC={sdp:aA,type:"answer"};ai=aC.sdp;aj.setRemoteDescription(aC,function(aF){AWL.console.error("setRemoteDescriptionErrorHandler: "+aF)});F=true;Y=CONST.AWL_MSG_CALL_PROGRESSING;ac.getAudioTracks().concat(ac.getVideoTracks()).forEach(function(aF){k[aF.id]=aF.kind});for(var aD in k){if(k[aD]==="audio"){ar=aD}else{W=aD}}}else{AWL.console.debug("no early media from gw");Y=CONST.AWL_MSG_CALL_RINGING}if(aE.FarEndDn){al=aE.FarEndDn}if(aE.sipUri){Q=aE.sipUri}AWL.onCallStateChange.notify(z,t,Y)}};this.mediaAnswerHandler=function(aE,aD){if((aE==="CallConnected")&&aD){if(aD.sdp){var aA=aD.sdp;AWL.console.debug("Answer: \n"+aA);if(F==false){var aB={sdp:aA,type:"answer"};ai=aB.sdp;aj.setRemoteDescription(aB,function(aF){AWL.console.error("setRemoteDescriptionErrorHandler: "+aF)})}else{AWL.console.debug("AWL-CallSession: Earley media answer already applied")}}Y=CONST.AWL_MSG_CALL_CONNECTED;ac.getAudioTracks().concat(ac.getVideoTracks()).forEach(function(aF){k[aF.id]=aF.kind});for(var aC in k){if(k[aC]==="audio"){ar=aC}else{W=aC}}AWL.onCallStateChange.notify(z,t,Y)}};this.mediaUpdateHandler=function(aG,aE){AWL.console.debug("callsession:mediaUpdateHandler - msgName: "+aG);switch(aG){case"updateMediaResponse":AWL.console.debug("callsession:UpdateMediaResponse - responseCode: "+aE.responseCode);if(aE.responseCode==="200"){if(G){AWL.console.log("callsession:Renegotiation - incoming Answer SDP received");var aC={sdp:aE.sdp,type:"answer"};ai=aE.sdp;K=false;G=false;if(y=="active"){aj.setRemoteDescription(aC,function(aH){AWL.console.error("setRemoteDescriptionErrorHandler: "+aH)},{optional:[{MozDontOfferDataChannel:true}]})}else{aj.setCustomRemoteDescription("upgrade","passive",aE.sdp)}}}else{AWL.console.warn("callsession:Renegotiation - UpdateMediaFailed");K=false;G=false;aj.setCustomLocalDescription("prevNegotiatedSDP",y,ax);setTimeout(function(){aj.setCustomRemoteDescription("prevNegotiatedSDP",y,ai)},100)}break;case"MediaUpdateRequest":if(!G&&!K){AWL.console.log("callsession:Renegotiation incoming Offer SDP received");var aD=false;var aF=ai.indexOf("m=audio");var aA=ai.indexOf("m=video");if(aA===-1){aD=false}else{var aB=null;if(aF>aA){aB=ai.slice(aA,aF)}else{if(aA>aF){aB=ai.slice(aA)}}if(aB!==null){if(aB.includes("a=inactive")){aD=false}else{aD=true}}}ai=aE.sdp;u=d(aE.sdp);if(!AWL.configuration.getInstance().getConfiguration().enableVideo){if(u){aE.sdp=T(aE.sdp);ai=aE.sdp;u=false}}else{if(u){if(!aD){aq()}}else{p()}}K=true;G=false;var aC={sdp:aE.sdp,type:"offer"};aj.setRemoteDescription(aC,function(aH){AWL.console.error("setRemoteDescriptionErrorHandler: "+aH);K=false;AWL.jsonRpc.sendRequest("rejectMediaUpdateRequest",z)},{optional:[{MozDontOfferDataChannel:true}]})}break;case"AcceptMediaUpdateResponse":case"RejectMediaUpdateResponse":AWL.console.debug("callsession:Renegotiation - response received msgName: "+aG);break;default:AWL.console.warn("callsession:Renegotiation - unhandled msgName: "+aG)}};this.getstats=function(){if(aj!==null){if(navigator.mozGetUserMedia){b=setInterval(function(){aj.getStats(null,function(aD){var aA="";for(var aC in aD){if(aD.hasOwnProperty(aC)){var aB=aD[aC];aA+="<h3>"+aC+"</h3>"+M(aB)}}},function(){})},2000)}else{b=setInterval(function(){aj.getStats(function(aD){var aC=aD.result();for(var aB=0;aB<aC.length;aB++){var aA=aC[aB];if(!aA.local||aA.local==aA){h(aA)}else{if(aA.local){h("local",aA.local)}else{if(aA.remote){h("remote",aA.remote)}}}}})},2000)}}};this.collectStats=function(){if(navigator.mozGetUserMedia){return av}else{var aA=[];aA.audio=ag;aA.video=R;return aA}};this.inComingCallHandler=function(aC){if(aC){al=aC.FarEndDn;V=aC.sdp;ai=aC.sdp;Q=aC.sipUri;if(Q!==null){var aB=Q.indexOf(":");var aA=Q.indexOf("@");aw=Q.slice(aB+1,aA)}if(aC.autoAnswer==="true"){Z=true}else{Z=false}}if(V){u=d(V)}if(u&&!AWL.configuration.getInstance().getConfiguration().enableVideo){V=T(V);ai=V;u=false}AWL.totalCalls++;Y=CONST.AWL_MSG_CALL_INCOMING;t=new AWL.clientCallObj(O);AWL.onNewIncomingCall.notify(z,t,Z);if(Z){AWL.console.debug("inComingCallHandler: autoAnswer - TRUE");AWL.callmanager.getInstance().answerCall(z)}else{if(!D&&AWL.serviceType===CONST.AGENTSERVICE){AWL.callmanager.getInstance().answerCall(z)}else{if(AWL.serviceType===CONST.AGENTSERVICE){AWL.console.warn("inComingCallHandler: _earlyMediaAnswer - TRUE ALREADY!")}else{AWL.console.debug("inComingCallHandler: autoAnswer - FALSE")}}}};this.callUpdateHandler=function(aD,aC){AWL.console.debug("callUpdateHandler: Type: "+aD+" Param: "+aC);if(aD==="FarEndChanged"){al=aC.FarEndDn;Q=aC.sipUri;if(Q!==null){var aB=Q.indexOf(":");var aA=Q.indexOf("@");aw=Q.slice(aB+1,aA)}Y=CONST.AWL_MSG_CALL_FAREND_UPDATE;AWL.onCallStateChange.notify(z,t,Y)}};this.callControllerHandler=function(aB,aA){AWL.console.debug("callControllerHandler: Event: "+aB+" params: "+aA);if(aA.ctiEvent==="talk"){if(Y===CONST.AWL_MSG_CALL_INCOMING){AWL.console.debug("callControllerHandler - TALK Event : answerCall triggered");B=true;AWL.callmanager.getInstance().answerCall(z)}else{if(ao){AWL.console.debug("callControllerHandler - TALK Event: call is in held state, unhold triggered");O.doUnHold()}else{AWL.console.error("callControllerHandler - TALK Event: invalid state:"+Y)}}}if((aA.ctiEvent==="hold")&&(N)){AWL.console.debug("callControllerHandler - HOLD Event: call is in active state, hold triggered");O.doHold()}};this.evtMediaDeviceAccessAcquired=function(aB){AWL.console.debug("Callsession :: evtMediaDeviceAccessAcquired");if(s){s=false;ap=aB;l=ap.getVideoTracks();if(l.length!==0){AWL.console.debug("callsession: Add available videoTracks");for(i=0;i<l.length;i++){ac.addTrack(l[i]);AWL.console.debug("Video Tracks Id: "+l[i].id)}q=false}if(AWL.configuration.getInstance().getConfiguration().enableVideo){if(AWL.inUse_Version==="10.0"){if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(aA,ap)}else{if(I!==null){AWL.webrtc.mediaSetStream(I,ac)}else{AWL.clientAPIConsole.debug("callmanager : Local video tag not set, application is responsible for attaching the localStream")}}}AWL.remVideo=false}if(y=="passive"){return}var aC={mandatory:{iceRestart:false}};if(navigator.webkitGetUserMedia){aj.addStream(ac)}G=true;aj.createOffer(function(aD){AWL.console.error("callsession: createOffer failed: "+aD);G=false},aC);return}else{ac=aB;m=ac.getAudioTracks()}if(AWL.configuration.getInstance().getConfiguration().enableVideo&&aa==="video"){if(AWL.inUse_Version==="10.0"){l=ac.getVideoTracks();if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(aA,ac)}else{if(I!==null){AWL.webrtc.mediaSetStream(I,ac)}else{AWL.clientAPIConsole.debug("callmanager : Local video tag not set, application is responsible for attaching the localStream")}}}AWL.remVideo=false}if(j){ah()}else{J()}};this.evtMediaDeviceAccessFailed=function(aA){AWL.console.error("callsession :: evtMediaDeviceAccessFailed");Y=CONST.AWL_MSG_CALL_FAILED;O.resetCall("Could not get access to audio device")};this.setDomElementForMedia=function(aB,aA){AWL.console.debug("callSession :: setDomElementForMedia : setting domElement "+aA+" for "+z);if(aA==="localVideo"){I=aB}else{ay=aB;X()}};this.isDomElementSet=function(){AWL.console.debug("callSession :: isDomElementSet ");if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""||ay!==null){if(AWL.configuration.getInstance().getDomElements().localVideo!==""||I!==null){return true}else{return false}}else{return false}};function ah(){AWL.console.debug("Callsession :: outGoingCall");y="active";if(!AWL.registration.getInstance().isloggedIn()){AWL.clientAPIConsole.error("callmanager : Call not allowed as user is not logged in");return}AWL.totalCalls++;if(AWL.totalCalls===CONST.MAX_ALLOWED_CALL_COUNT){AWL.clientAPIConsole.error("callmanager : MAX ALLOWED CALL LIMIT REACHED");Y=CONST.AWL_MSG_CALL_FAILED;AWL.onCallStateChange.notify(z,t,Y);AWL.onCallTerminate.notify(t,"Max call limit reached");AWL.totalCalls--;delete AWL.callMap[z];return}if(AWL.configuration.getInstance().getConfiguration().enableVideo){if(typeof(aa)==="undefined"){u=false}else{if(aa==="video"){u=true;if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(aA,ac)}else{if(I!==null){AWL.webrtc.mediaSetStream(I,ac)}else{AWL.clientAPIConsole.debug("outGoingCall : Local video tag not set, application is responsible for attaching the localStream")}}}else{u=false}}}if((((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0)&&(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0)){ak.iceServers=[AWL.configuration.getInstance().getStunServerURL(),AWL.configuration.getInstance().getTurnServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0){ak.iceServers=[AWL.configuration.getInstance().getStunServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0){ak.iceServers=[AWL.configuration.getInstance().getTurnServerURL()]}else{ak.iceServers=[]}}}N=true;aj=new AWL.webrtc.PeerConnection();aj.evtRemoteStream.attach(x);aj.evtLocalCandidates.attach(E);aj.evtLocalDescription.attach(w);if(navigator.webkitGetUserMedia){aj.evtReattachingStream.attach(e)}aj.evtICEConnectivity.attach(an);aj.init({rtcConfiguration:ak,constraints:{optional:[{DtlsSrtpKeyAgreement:true}]}});aj.addStream(ac);aj.createOffer(function(aB){AWL.console.error("callsession: createOffer failed: "+aB)},{optional:[{MozDontOfferDataChannel:true}]})}function J(){AWL.clientAPIConsole.debug("\ncallsession :: incomingCall");y="passive";if(!D){if(AWL.serviceType===CONST.AGENTSERVICE&&!Z){D=true;AWL.clientAPIConsole.debug("incomingCall ::  _earlyMediaAnswer set to TRUE");if(B){f=true;AWL.console.debug("Received answerCall but earlyMediaAnswer is not yet sent\n")}}if(!AWL.registration.getInstance().isloggedIn()){AWL.clientAPIConsole.error("callmanager : Call not allowed as user is not logged in");return}if(U(L.answerCall)){AWL.clientAPIConsole.error("callsession : Duplicate answer request - ignored!");return}if(AWL.totalCalls===CONST.MAX_ALLOWED_CALL_COUNT){AWL.clientAPIConsole.error("callsession : MAX ALLOWED CALL LIMIT REACHED");Y=CONST.AWL_MSG_CALL_FAILED;AWL.onCallStateChange.notify(z,t,Y);AWL.onCallTerminate.notify(t,"Max call limit reached");return}N=true;if((((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0)&&(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0)){ak.iceServers=[AWL.configuration.getInstance().getStunServerURL(),AWL.configuration.getInstance().getTurnServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0){ak.iceServers=[AWL.configuration.getInstance().getStunServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0){ak.iceServers=[AWL.configuration.getInstance().getTurnServerURL()]}else{ak.iceServers=[]}}}aj=new AWL.webrtc.PeerConnection();aj.evtRemoteStream.attach(x);aj.evtLocalCandidates.attach(E);aj.evtLocalDescription.attach(w);if(navigator.webkitGetUserMedia){aj.evtReattachingStream.attach(e)}aj.evtICEConnectivity.attach(an);aj.init({rtcConfiguration:ak,constraints:{optional:[{DtlsSrtpKeyAgreement:true}]}});aj.addStream(ac);var aA={sdp:V,type:"offer"};aj.setRemoteDescription(aA,function(aB){AWL.console.error("setRemoteDescriptionErrorHandler: "+aB)},{optional:[{MozDontOfferDataChannel:true}]})}else{if(ae!==null){AWL.console.debug("Early Media Answer sent already! Resend same SDP again in answer: \n"+ae);AWL.jsonRpc.sendRequest("answerCall",z,ae)}else{f=true;AWL.console.debug("Received answerCall but earlyMediaAnswer is not yet sent\n")}}}function az(){AWL.console.debug("removeTrackAPIFirefox");if(navigator.mozGetUserMedia){var aA=navigator.userAgent.match(/Firefox\/(.*)$/);if(aA&&aA.length>1){if(aA[1]>=44){return true}}return false}}function h(aE){if(aE.names){var aD=aE.names();for(var aB=0;aB<aD.length;aB++){var aA=aD[aB];var aC=aE.stat(aA);if(aA==="googChannelId"){if(aC==="Channel-audio-1"){for(var aB=0;aB<aD.length;aB++){var aA=aD[aB];var aC=aE.stat(aA);if(aA==="bytesReceived"){ag[aA]=aC}}}else{if(aC==="Channel-video-1"){for(var aB=0;aB<aD.length;aB++){var aA=aD[aB];var aC=aE.stat(aA);if(aA==="bytesReceived"){R[aA]=aC}}}}}}for(var aB=0;aB<aD.length;aB++){var aA=aD[aB];var aC=aE.stat(aA);if(aA==="googTrackId"&&aC===ar){for(var aB=0;aB<aD.length;aB++){var aA=aD[aB];var aC=aE.stat(aA);if(aA==="audioInputLevel"||aA==="googCodecName"||aA==="googJitterReceived"||aA==="packetsSent"||aA==="bytesSent"||aA==="bytesReceived"||aA==="packetsLost"||aA==="packetsReceived"||aA==="audioOutputLevel"||aA==="googJitterReceived"){ag[aA]=aC}}}else{if(aA==="googTrackId"&&aC===W){for(var aB=0;aB<aD.length;aB++){var aA=aD[aB];var aC=aE.stat(aA);if(aA==="googCodecName"||aA==="googJitterReceived"||aA==="packetsSent"||aA==="bytesSent"||aA==="bytesReceived"||aA==="packetsLost"||aA==="packetsReceived"||aA==="audioOutputLevel"||aA==="googJitterReceived"){R[aA]=aC}}}}}}else{if(aE.stat("audioOutputLevel")){AWL.console.debug(type+" : audioOutputLevel and "+aE.stat("audioOutputLevel"))}}}function M(aA){if(aA.type=="inboundrtp"){if(aA.isRemote){var aB=[];aB.bytesReceived=aA.bytesReceived;aB.packetsReceived=aA.packetsReceived;aB.jitter=aA.jitter;aB.packetsLost=aA.packetsLost;aB.ssrc=aA.ssrc;if(aA.mediaType==="audio"){av.remoteInboundAudio=aB}else{av.remoteInboundVideo=aB}}else{var aB=[];aB.bytesReceived=aA.bytesReceived;aB.packetsReceived=aA.packetsReceived;aB.jitter=aA.jitter;aB.packetsLost=aA.packetsLost;aB.ssrc=aA.ssrc;if(aA.mediaType==="audio"){av.localInboundAudio=aB}else{av.localInboundVideo=aB}}}else{if(aA.type=="outboundrtp"){if(aA.isRemote){var aB=[];aB.bytesSent=aA.bytesSent;aB.packetsSent=aA.packetsSent;aB.ssrc=aA.ssrc;if(aA.mediaType==="audio"){av.remoteOutboundAudio=aB}else{av.remoteOutboundVideo=aB}}else{var aB=[];aB.bytesSent=aA.bytesSent;aB.packetsSent=aA.packetsSent;aB.ssrc=aA.ssrc;if(aA.mediaType==="audio"){av.localOutboundAudio=aB}else{av.localOutboundVideo=aB}}}}}function x(aD,aB){AWL.console.debug("evtRemoteStreamHandler: "+aB.type);if(aB.type==="audio"){AWL.call.utility.getInstance().createAudioTag(z);rmtAud=document.getElementById(z);AWL.webrtc.mediaSetStream(rmtAud,aB.stream);u=false;am=aB.stream;X()}else{if(aB.type==="video"||aB.type==="audiovideo"){u=true;if(AWL.configuration.getInstance().getConfiguration().enableVideo){if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var aC=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(aC,ac)}else{if(I!==null){AWL.webrtc.mediaSetStream(I,ac)}else{AWL.console.debug("evtRemoteStreamHandler: Not Attaching the localStreams since application is handling the Stream")}}}if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""){var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);AWL.remoteStreams[z]=aB.stream;AWL.webrtc.mediaSetStream(aA,aB.stream)}else{if(ay!==null){AWL.webrtc.mediaSetStream(ay,aB.stream)}else{AWL.console.debug("evtRemoteStreamHandler: Not Attaching the remoteStreams since application is handling the Stream")}}am=aB.stream;X()}}}function X(){var aA=AWL.configuration.getInstance().getDeviceIds().audioOutputID;if(aA){if(aA!==null&&typeof(aA)!=="undefined"&&aA!=""){O.routeAudioOutput(aA)}}}function P(aB,aA){aB.srcObject=aA.srcObject}function e(){console.log("callSession :: evtReattachingStreamHandler");if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""){var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);P(aA,aA)}else{if(ay!==null){P(ay,ay)}else{AWL.console.debug("evtReattachingStreamHandler: Not Attaching the remoteStreams since application is handling the Stream")}}}this.routeAudioOutput=function(aB){AWL.console.debug("routeAudioOutput: "+aB);var aA="";if(u){aA=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);if(aA==null){aA=ay}}else{aA=document.getElementById(z)}if(aA==null){AWL.console.error("routeAudioOutput: streamElement is null");return}if(typeof(aA.sinkId)!=="undefined"){aA.setSinkId(aB)}else{AWL.console.warn("Browser does not support output device selection.")}};function w(aB,aA){AWL.console.debug("evtLocalDescriptionHandler");if((!G)&&(!K)){if(V){if(D){if(navigator.mozGetUserMedia){aA.sdp=v(aA.sdp)}ae=aA.sdp;if(f){r[L.answerCall]=true;if(z in AWL.callMap){AWL.console.debug("Send answer instead of earlyMediaAnswer: \n"+aA.sdp);AWL.jsonRpc.sendRequest("answerCall",z,aA.sdp)}else{AWL.clientAPIConsole.error("Ignore sending answerCall as the callObject does not exist")}}else{if(z in AWL.callMap){AWL.console.debug("Answer EarlyMedia: \n"+aA.sdp);AWL.jsonRpc.sendRequest("answerEarlyMedia",z,aA.sdp)}else{AWL.clientAPIConsole.error("Ignore sending answerEarlyMedia as the callObject does not exist")}}}else{AWL.console.debug("Answer: \n"+aA.sdp);r[L.answerCall]=true;if(navigator.mozGetUserMedia){aA.sdp=v(aA.sdp)}AWL.jsonRpc.sendRequest("answerCall",z,aA.sdp)}}else{if(navigator.mozGetUserMedia){if(!u&&AWL.configuration.getInstance().getConfiguration().enableVideo){AWL.console.debug("Audio OnlyCall - mark video SDP inactive\n");aA=aj.getCustomLocalDescription("remVideo")}}AWL.callMap[z]=O;AWL.console.debug("Offer: \n"+aA.sdp);if(navigator.mozGetUserMedia){aA.sdp=v(aA.sdp)}AWL.jsonRpc.sendRequest("makeCall",aw,z,aA.sdp)}ax=aA.sdp}else{if((G)&&(!K)){if(navigator.mozGetUserMedia){if(!u&&AWL.configuration.getInstance().getConfiguration().enableVideo){AWL.console.debug("Audio OnlyCall - mark video SDP inactive\n");aA=aj.getCustomLocalDescription("remVideo")}}AWL.console.debug("Re Offered SDP: \n"+aA.sdp);if(navigator.mozGetUserMedia){aA.sdp=v(aA.sdp)}ax=aA.sdp;AWL.jsonRpc.sendRequest("updateMedia",z,aA.sdp)}else{if((!G)&&(K)){AWL.console.debug("Re Answered SDP: \n"+aA.sdp);if(navigator.mozGetUserMedia){aA.sdp=v(aA.sdp)}ax=aA.sdp;AWL.jsonRpc.sendRequest("acceptMediaUpdateRequest",z,aA.sdp);K=false}else{AWL.console.error("Renegotiation error: reOfferState: "+G+" reAnsweState: "+K);return}}}}function v(aB){if(aB.indexOf("a=candidate:")!==-1){var aC=aB.indexOf("a=candidate:");var aA=aB.slice(0,aC);var aD=aB.slice(aC).split("\n");var aE="";for(i=0;i<aD.length;i++){if(aD[i].indexOf("a=candidate:")!==-1&&(aD[i].match(/:/g)||[]).length>=3){aD[i]=""}else{aE+=aD[i]+"\n"}}var aF=aA+aE;AWL.console.debug("removed IPv6 candidates ::\n"+aF);return aF}else{AWL.console.error("Candidates are missing in the generated SDP");return aB}}function E(aB,aA){AWL.console.debug("evtLocalCandidatesHandler: "+aA)}function c(){if((!ao)&&((Y===CONST.AWL_MSG_CALL_CONNECTED)||(Y===CONST.AWL_MSG_CALL_FAREND_UPDATE))&&(N)){if(navigator.webkitGetUserMedia){aj.setCustomLocalDescription("hold",y)}else{if(AWL.webrtc.mozRenegotiationSupport()){aj.createOffer(function(aA){AWL.console.error("callsession: createOffer failed: "+aA)},{},function(aA){aj.setCustomLocalDescription("hold",y,aA.sdp)})}}r[L.holdCall]=true;AWL.jsonRpc.sendRequest("holdCall",z);AWL.clientAPIConsole.debug("\ncallsession: holdCall request sent")}else{if(AWL.serviceType===CONST.AGENTSERVICE&&Y===CONST.AWL_MSG_CALL_INCOMING){AWL.clientAPIConsole.debug("\ncallsession: Ignore sending holdCall request as call is in incoming state")}else{AWL.clientAPIConsole.error("\ncallsession: call is already in held state")}}}function af(){if((ao)&&((Y===CONST.AWL_MSG_CALL_HELD)||(Y===CONST.AWL_MSG_CALL_FAREND_UPDATE))&&(!N)){AWL.callmanager.getInstance().autoHoldIfRequired();if(navigator.webkitGetUserMedia){aj.setCustomLocalDescription("unhold",y)}else{if(AWL.webrtc.mozRenegotiationSupport()){aj.createOffer(function(aA){AWL.console.error("callsession: createOffer failed: "+aA)},{},function(aA){aj.setCustomLocalDescription("unhold",y,aA.sdp)})}}r[L.unholdCall]=true;AWL.jsonRpc.sendRequest("unholdCall",z);AWL.clientAPIConsole.debug("\ncallsession: unholdCall request sent")}else{AWL.clientAPIConsole.error("\ncallsession: call is already in unheld state")}}function ab(){if((navigator.webkitGetUserMedia)||(navigator.mozGetUserMedia&&!AWL.muteAllStreams)){m=ac.getAudioTracks();if(m.length===0){AWL.console.debug("No local audio available.");return false}if(!au){for(i=0;i<m.length;i++){m[i].enabled=false;AWL.console.debug("Audio Tracks Id: "+m[i].id)}AWL.clientAPIConsole.debug("Audio muted.");au=!au;return true}}return false}function H(){if((navigator.webkitGetUserMedia)||(navigator.mozGetUserMedia&&!AWL.muteAllStreams)){m=ac.getAudioTracks();if(m.length===0){AWL.console.debug("No local audio available.");return false}if(au){for(i=0;i<m.length;i++){AWL.console.debug("Audio Tracks Id: "+m[i].id);m[i].enabled=true}AWL.clientAPIConsole.debug("Audio unmuted.");au=!au;return true}}return false}function ad(){m=ac.getAudioTracks();if(m.length===0){AWL.clientAPIConsole.debug("No local audio available.");return}if(!AWL.muteAllStreams){if(!au){for(i=0;i<m.length;i++){m[i].enabled=false}}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Audio stopped");if(l!==null){if(l.length!==0){for(i=0;i<l.length;i++){if(!AWL.videoPaused){l[i].enabled=false}var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);aA.pause()}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Video stopped")}}}else{if(!au){for(i=0;i<m.length;i++){m[i].enabled=true}}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Audio resumed");if(l!==null){if(l.length!==0){for(i=0;i<l.length;i++){if(!AWL.videoPaused){l[i].enabled=true}var aA=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);aA.play()}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Video resumed")}}}AWL.muteAllStreams=!AWL.muteAllStreams}function C(aA){if(aA){AWL.console.debug("Sent Dtmf tone: \t"+aA.tone)}}function d(aB){if(typeof(aB)!=="undefined"){var aA=aB.indexOf("m=video");if(aA===-1){return false}return true}AWL.console.error("checkIfVideoCall: argument missing");return false}function U(aA){if(typeof(r[aA])!=="undefined"){if(r[aA]){return true}}return false}function T(aB){var aE=aB.indexOf("m=audio");var aA=aB.indexOf("m=video");var aD=aB.indexOf("a=sendrecv");var aC=aB.lastIndexOf("a=sendrecv");AWL.console.debug("\n idxAud = "+aE+"\nidxVid = "+aA+"\nidxFirst = "+aD+"\nidxLast = "+aC);if(aA===-1){}else{if(aE>aA){if((aD!=aC)&&(aD>aA)&&(aD<aE)){aB=aB.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{if((aD===aC)&&(aD>aA)&&(aD<aE)){aB=aB.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpVidSDP=aB.slice(0,aE);tmpAudSDP=aB.slice(aE);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");aB=tmpVidSDP.concat(tmpAudSDP)}}}else{if((aD!=aC)&&(aD>aE)&&(aD<aA)){tmpAudSDP=aB.slice(0,aA);tmpVidSDP=aB.slice(aA);tmpVidSDP=tmpVidSDP.replace(/a=sendrecv\r\n/,"a=inactive\r\n");aB=tmpAudSDP.concat(tmpVidSDP)}else{if((aD===aC)&&(aD>aE)&&(aD>aA)){aB=aB.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpAudSDP=aB.slice(0,aA);tmpVidSDP=aB.slice(aA);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");aB=tmpAudSDP.concat(tmpVidSDP)}}}}AWL.console.debug("Modified Audio Only SDP \n "+aB);return aB}function an(aB,aA){AWL.console.debug("callsession :: evtICEConnectivityHandler");if(aA.iceStatus==="connected"&&Y===CONST.AWL_MSG_CALL_CONNECTED){if(u&&!n&&AWL.onVideoStreamsAvailable){if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""&&AWL.configuration.getInstance().getDomElements().localVideo!==""){AWL.console.debug("evtICEConnectivityHandler:VideoStream available event not sent as Dom Elements are initally set")}else{g()}return}if(!u&&!at&&AWL.onAudioStreamsAvailable){g();return}}}function g(){AWL.console.debug("callsession :: notifyAfterRmtStrmAvbl");if(am!==null){if(S!==null){clearTimeout(S);S=null}if(u&&!n&&Y===CONST.AWL_MSG_CALL_CONNECTED){AWL.console.debug("callsession :: notifyAfterRmtStrmAvbl : onVideoStreamsAvailable event notified");AWL.onVideoStreamsAvailable.notify(z,ac,am);n=true}else{if(!u&&!at&&Y===CONST.AWL_MSG_CALL_CONNECTED){AWL.console.debug("callsession :: notifyAfterRmtStrmAvbl : onAudioStreamsAvailable event notified");AWL.onAudioStreamsAvailable.notify(z,ac,am);at=true}else{AWL.console.debug("callsession :: notifyAfterRmtStrmAvbl : No notification sent")}}}else{if(S!==null){clearTimeout(S);S=null}AWL.console.debug("callsession :: notifyAfterRmtStrmAvbl : remote stream is not yet available");S=setTimeout(function(){g()},100)}}};return a}();AWL.namespace("callsession_9_1version");AWL.callsession_9_1version=function(){var a=function(){var G=this;var J="";var q="";var E="";var c=null;var g=false;var O={};var j=false;var A=false;var o="";var e=null;var M=null;var F=false;var f=CONST.AWL_MSG_CALL_IDLE;var v="";var y=false;var H=false;var r=null;var N=false;var d=null;var s="";var K="";var w="";var m=false;this.setCallID=function(P){J=P};this.getCallID=function(){return J};this.getCallState=function(){return f};this.getFarEndNumber=function(){return q};this.getFarEndName=function(){return E};this.isAutoAnswer=function(){return y};this.isVideoCall=function(){return g};this.makeCall=function(P,R,Q){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: makeCall");s="active";v=Q;q=P;E=P;w=R;if(!AWL.registration.getInstance().isloggedIn()){AWL.clientAPIConsole.error("callmanager : Call not allowed as user is not logged in");return}AWL.totalCalls++;if(AWL.totalCalls===CONST.MAX_ALLOWED_CALL_COUNT){AWL.clientAPIConsole.error("callmanager : MAX ALLOWED CALL LIMIT REACHED");AWL.totalCalls--;f=CONST.AWL_MSG_CALL_FAILED;setTimeout(function(){AWL.onCallStateChange.notify(J,v,f);AWL.onCallTerminate.notify(v,"Max call limit reached")},200);return}if(((q).trim()).length===0){return}m=true;AWL.devicemanager.getInstance().getUserMedia(AWL.callMap[J],w)};this.isCallActive=function(){return F};this.answerCall=function(){AWL.clientAPIConsole.debug("\ncallsession :: answerCall");if(!H){if(g){w="video"}else{w="audio"}m=false;AWL.devicemanager.getInstance().getUserMedia(AWL.callMap[J],w)}else{I()}};this.rejectCall=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: rejectCall");AWL.jsonRpc.call(AWL.serviceType,"dropCall",J);G.resetCall("Call Rejected")};this.dropCall=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: dropCall");AWL.jsonRpc.call(AWL.serviceType,"dropCall",J);G.resetCall("Call Dropped")};this.cancelCall=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: cancelCall");AWL.jsonRpc.call(AWL.serviceType,"dropCall",J);G.resetCall("Call Cancelled")};this.doHold=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: doHold");B()};this.doUnHold=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: doUnHold");n()};this.doMute=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: doMute");return(u())};this.doUnMute=function(){AWL.clientAPIConsole.debug("\ncallsession_9_1version :: doUnMute");return(b())};this.sendDTMF=function(R){var Q=500;var S=50;if(_stream!==null){var P=_stream.getAudioTracks()[0];e=c.createDTMFSender(P);if(e){if(e.canInsertDTMF){AWL.clientAPIConsole.debug("Call eligible to do DTMF");AWL.console.debug("Call eligible to do DTMF");e.insertDTMF(R,Q,S);e.ontonechange=L}else{AWL.console.error("\ncallsession_9_1version :: Call not eligible to do dtmf")}}}};this.resetCall=function(U){AWL.console.debug("\ncallsession_9_1version :: resetCall");M=null;q="";E="";e=null;F=false;y=false;H=false;N=false;r=null;d=null;s="";AWL.totalCalls--;if(A){b()}if(c){c.close();c=null}if(_stream!==null&&typeof(_stream)!=="undefined"){var S=_stream.getAudioTracks();for(i=0;i<S.length;i++){S[i].stop();AWL.console.debug("\ncallsession_9_1version :: resetCall :: releasing Audio Device from this callSession")}var Q=_stream.getVideoTracks();for(i=0;i<Q.length;i++){Q[i].stop();AWL.console.debug("\ncallsession_9_1version :: resetCall :: releasing Video Device from this callSession")}_stream=null}if((AWL.configuration.getInstance().getDomElements().remoteVideo!="")&&(g)){var R=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);AWL.webrtc.mediaReset(R)}if((AWL.configuration.getInstance().getDomElements().localVideo!="")&&(g)){var T=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaReset(T)}g=false;var P=document.getElementById(J);if(P!=null){AWL.webrtc.mediaReset(P);document.body.removeChild(P)}delete AWL.callMap[J];if(f!==CONST.AWL_MSG_CALL_DISCONNECTED){AWL.onCallStateChange.notify(J,v,f)}AWL.onCallTerminate.notify(v,U)};this.callStateHandler=function(P){AWL.console.debug("callStateHandler: State: "+P[0]+" Param: "+P[1]);if(P[0]==="TERMINATED"){f=CONST.AWL_MSG_CALL_DISCONNECTED;AWL.onCallStateChange.notify(J,v,f);G.resetCall(P[1])}else{if(P[0]==="PROGRESS"){if(!P[1]){status+="Trying"}else{f=CONST.AWL_MSG_CALL_RINGING}}else{if(P[0]==="ACTIVE"){f=CONST.AWL_MSG_CALL_CONNECTED}}AWL.onCallStateChange.notify(J,v,f)}};this.mediaAnswerHandler=function(R){var P=R[0];d=P;AWL.console.debug("Answer: \n"+P);var Q={sdp:P,type:"answer"};c.setRemoteDescription(Q,function(S){AWL.console.error("setRemoteDescriptionErrorHandler: "+S)})};this.inComingCallHandler=function(P){q=P[0];E=P[0];M=P[1];AWL.totalCalls++;f=CONST.AWL_MSG_CALL_INCOMING;v=new AWL.clientCallObj(G);if(M){g=l(M)}if(g&&!AWL.configuration.getInstance().getConfiguration().enableVideo){M=x(M);g=false}d=M;if(AWL.serviceType===CONST.AGENTSERVICE){y=P[3]}AWL.onNewIncomingCall.notify(J,v,y);if(AWL.serviceType===CONST.AGENTSERVICE){if(y){AWL.console.debug("inComingCallHandler: autoAnswer - TRUE");G.answerCall(J)}else{if(!H){G.answerCall(J)}else{AWL.console.warn("inComingCallHandler: _earlyMediaAnswer - TRUE ALREADY!")}}}};this.callUpdateHandler=function(P){AWL.console.debug("callUpdateHandler: Type: "+P[0]+" Param: "+P[1]);if(P[0]==="displayupdate"){q=P[1];E=P[1];f=CONST.AWL_MSG_CALL_FAREND_UPDATE;AWL.onCallStateChange.notify(J,v,f)}};this.callControllerHandler=function(P){AWL.console.debug("callControllerHandler: Event: "+P[1]+" CallId: "+P[0]);if(P[1]==="talk"){if(f===CONST.AWL_MSG_CALL_INCOMING){AWL.console.debug("callControllerHandler - TALK Event : answerCall triggered");G.answerCall()}else{if(j){AWL.console.debug("callControllerHandler - TALK Event: call is in held state, unhold triggered");G.doUnHold()}else{AWL.console.error("callControllerHandler - TALK Event: invalid state:"+f)}}}if((P[1]==="hold")&&(F)){AWL.console.debug("callControllerHandler - HOLD Event: call is in active state, hold triggered");G.doHold()}};this.evtMediaDeviceAccessAcquired=function(Q){if(navigator.mozGetUserMedia){clearTimeout(mozWebUserChoice)}AWL.console.debug("Callsession :: evtMediaDeviceAccessAcquired");_stream=Q;_videoTracks=_stream.getVideoTracks();o=_stream.getAudioTracks();if(AWL.configuration.getInstance().getConfiguration().enableVideo){if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var P=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(P,_stream)}else{AWL.console.error("\ncallsession_9_1version :: LocalVideo DOM element not set to make video call")}AWL.console.debug("Audio Tracks Id: "+o[0].id);AWL.remVideo=false}if(m){C()}else{I()}};this.evtMediaDeviceAccessFailed=function(P){AWL.console.debug("callsession :: evtMediaDeviceAccessFailed");if(navigator.mozGetUserMedia){clearTimeout(mozWebUserChoice)}AWL.console.error("evtMediaDeviceAccessFailed");reset({result:CONST.AWL_MSG_DEVICEACCESS_FAILURE,reason:"Could not get access to audio device"})};function k(S,Q){AWL.console.debug("evtRemoteStreamHandler: "+Q.type);if(Q.type==="audio"){AWL.call.utility.getInstance().createAudioTag(J);rmtAud=document.getElementById(J);AWL.webrtc.mediaSetStream(rmtAud,Q.stream)}else{if(Q.type==="video"||Q.type==="audiovideo"){g=true;if(AWL.configuration.getInstance().getConfiguration().enableVideo){if(AWL.configuration.getInstance().getDomElements().localVideo!==""){var R=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(R,_stream)}}if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""){var P=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);AWL.webrtc.mediaSetStream(P,Q.stream)}}}}function z(Q,P){AWL.console.debug("evtLocalDescriptionHandler");if(M){if(H){r=P.sdp;if(N){AWL.console.debug("Send answer instead of earlyMediaAnswer: \n"+P.sdp);AWL.jsonRpc.call(AWL.serviceType,"answerCall",P.sdp,J)}else{AWL.console.debug("Answer EarlyMedia: \n"+P.sdp);AWL.jsonRpc.call(AWL.serviceType,"answerEarlyMedia",P.sdp,J)}}else{AWL.console.debug("Answer: \n"+P.sdp);AWL.jsonRpc.call(AWL.serviceType,"answerCall",P.sdp,J)}}else{if(navigator.mozGetUserMedia){if(!g&&AWL.configuration.getInstance().getConfiguration().enableVideo){AWL.console.debug("Audio OnlyCall - mark video SDP inactive\n");P=c.getCustomLocalDescription("remVideo")}}AWL.callMap[J]=G;AWL.console.debug("Offer: \n"+P.sdp);AWL.jsonRpc.call(AWL.serviceType,"makeCall",q,P.sdp,J)}}function p(Q,P){AWL.console.debug("evtLocalCandidatesHandler: "+P)}function h(Q,P){Q.srcObject=P.srcObject}function t(){console.log("callSession :: evtReattachingStreamHandler");if(AWL.configuration.getInstance().getDomElements().remoteVideo!==""){var P=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);h(P,P)}}function B(){if((!j)&&((f===CONST.AWL_MSG_CALL_CONNECTED)||(f===CONST.AWL_MSG_CALL_FAREND_UPDATE))&&(F)){F=false;j=!j;if(navigator.mozGetUserMedia){D()}else{c.setCustomLocalDescription("hold",s);setTimeout(function(){c.setCustomRemoteDescription("hold",s,d)},100)}f=CONST.AWL_MSG_CALL_HELD;AWL.clientAPIConsole.debug("\ncallsession_9_1version: call is held");AWL.jsonRpc.call(AWL.serviceType,"hold",J);AWL.onCallStateChange.notify(J,v,f)}else{AWL.clientAPIConsole.error("\ncallsession_9_1version: call is already in held state")}}function n(){if((j)&&((f===CONST.AWL_MSG_CALL_HELD)||(f===CONST.AWL_MSG_CALL_FAREND_UPDATE))&&(!F)){AWL.callmanager_9_1version.getInstance().autoHoldIfRequired();F=true;j=!j;if(navigator.mozGetUserMedia){D()}else{c.setCustomLocalDescription("unhold",s);setTimeout(function(){c.setCustomRemoteDescription("unhold",s,d)},100)}f=CONST.AWL_MSG_CALL_CONNECTED;AWL.clientAPIConsole.debug("\ncallsession_9_1version: call is unheld");AWL.jsonRpc.call(AWL.serviceType,"unhold",J);AWL.onCallStateChange.notify(J,v,f)}else{AWL.clientAPIConsole.error("\ncallsession_9_1version: call is already in unheld state")}}function u(){if((navigator.webkitGetUserMedia)||(navigator.mozGetUserMedia&&!AWL.muteAllStreams)){o=_stream.getAudioTracks();if(o.length===0){AWL.console.debug("No local audio available.");return false}if(!A){for(i=0;i<o.length;i++){o[i].enabled=false}AWL.clientAPIConsole.debug("Audio muted.");A=!A;return true}}return false}function b(){if((navigator.webkitGetUserMedia)||(navigator.mozGetUserMedia&&!AWL.muteAllStreams)){o=_stream.getAudioTracks();if(o.length===0){AWL.console.debug("No local audio available.");return false}if(A){for(i=0;i<o.length;i++){o[i].enabled=true}AWL.clientAPIConsole.debug("Audio unmuted.");A=!A;return true}}return false}function D(){o=_stream.getAudioTracks();if(o.length===0){AWL.clientAPIConsole.debug("No local audio available.");return}if(!AWL.muteAllStreams){if(!A){for(i=0;i<o.length;i++){o[i].enabled=false}}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Audio stopped");if(_videoTracks!==null){if(_videoTracks.length!==0){for(i=0;i<_videoTracks.length;i++){_videoTracks[i].enabled=false;var P=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);P.pause()}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Video stopped")}}}else{if(!A){for(i=0;i<o.length;i++){o[i].enabled=true}}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Audio resumed");if(_videoTracks!==null){if(_videoTracks.length!==0){for(i=0;i<_videoTracks.length;i++){_videoTracks[i].enabled=true;var P=document.getElementById(AWL.configuration.getInstance().getDomElements().remoteVideo);P.play()}AWL.clientAPIConsole.debug("toggleHoldControlMoz: Video resumed")}}}AWL.muteAllStreams=!AWL.muteAllStreams}function l(Q){if(typeof(Q)!=="undefined"){var P=Q.indexOf("m=video");if(P===-1){return false}return true}AWL.console.error("checkIfVideoCall: argument missing");return false}function L(P){if(P){AWL.console.debug("Sent Dtmf tone: \t"+P.tone)}}function x(Q){var T=Q.indexOf("m=audio");var P=Q.indexOf("m=video");var S=Q.indexOf("a=sendrecv");var R=Q.lastIndexOf("a=sendrecv");AWL.console.debug("\n idxAud = "+T+"\nidxVid = "+P+"\nidxFirst = "+S+"\nidxLast = "+R);if(P===-1){}else{if(T>P){if((S!=R)&&(S>P)&&(S<T)){Q=Q.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{if((S===R)&&(S>P)&&(S<T)){Q=Q.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpVidSDP=Q.slice(0,T);tmpAudSDP=Q.slice(T);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");Q=tmpVidSDP.concat(tmpAudSDP)}}}else{if((S!=R)&&(S>T)&&(S<P)){tmpAudSDP=Q.slice(0,P);tmpVidSDP=Q.slice(P);tmpVidSDP=tmpVidSDP.replace(/a=sendrecv\r\n/,"a=inactive\r\n");Q=tmpAudSDP.concat(tmpVidSDP)}else{if((S===R)&&(S>T)&&(S>P)){Q=Q.replace(/a=sendrecv\r\n/,"a=inactive\r\n")}else{tmpAudSDP=Q.slice(0,P);tmpVidSDP=Q.slice(P);tmpVidSDP=tmpVidSDP.concat("a=inactive\r\n");Q=tmpAudSDP.concat(tmpVidSDP)}}}}AWL.console.debug("Modified Audio Only SDP \n "+Q);return Q}function C(){AWL.callmanager_9_1version.getInstance().autoHoldIfRequired();if(AWL.configuration.getInstance().getConfiguration().enableVideo){if(typeof(w)==="undefined"){g=false}else{if(w==="video"){g=true;if(AWL.configuration.getInstance().getDomElements().localVideo!=""){var P=document.getElementById(AWL.configuration.getInstance().getDomElements().localVideo);AWL.webrtc.mediaSetStream(P,_stream)}else{AWL.console.error("\ncallsession_9_1version :: LocalVideo DOM element not set to make video call")}}else{g=false}}}if((((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0)&&(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0)){O.iceServers=[AWL.configuration.getInstance().getStunServerURL(),AWL.configuration.getInstance().getTurnServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0){O.iceServers=[AWL.configuration.getInstance().getStunServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0){O.iceServers=[AWL.configuration.getInstance().getTurnServerURL()]}else{O.iceServers=[]}}}F=true;c=new AWL.webrtc.PeerConnection();c.evtRemoteStream.attach(k);c.evtLocalCandidates.attach(p);c.evtLocalDescription.attach(z);if(navigator.webkitGetUserMedia){c.evtReattachingStream.attach(t)}c.init({rtcConfiguration:O,constraints:{optional:[{DtlsSrtpKeyAgreement:true}]}});c.addStream(_stream);c.createOffer(function(Q){AWL.console.error("callsession_9_1version: createOffer failed: "+Q)},{optional:[{MozDontOfferDataChannel:true}]})}function I(){s="passive";if(!H){if(AWL.serviceType===CONST.AGENTSERVICE&&!y){H=true;AWL.clientAPIConsole.debug("incomingCall ::  _earlyMediaAnswer set to TRUE")}AWL.clientAPIConsole.debug("\ncallsession_9_1version :: incomingcall()");if(!AWL.registration.getInstance().isloggedIn()){AWL.clientAPIConsole.error("callmanager : Call not allowed as user is not logged in");return}if(AWL.totalCalls===CONST.MAX_ALLOWED_CALL_COUNT){AWL.clientAPIConsole.error("callmanager : MAX ALLOWED CALL LIMIT REACHED");AWL.totalCalls--;f=CONST.AWL_MSG_CALL_FAILED;AWL.onCallStateChange.notify(J,v,f);AWL.onCallTerminate.notify(v,"Max call limit reached");return}AWL.callmanager_9_1version.getInstance().autoHoldIfRequired();F=true;if((((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0)&&(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0)){O.iceServers=[AWL.configuration.getInstance().getStunServerURL(),AWL.configuration.getInstance().getTurnServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Stunserver.ip).trim()).length!==0){O.iceServers=[AWL.configuration.getInstance().getStunServerURL()]}else{if(((AWL.configuration.getInstance().getConfiguration().Turnserver.ip).trim()).length!==0){O.iceServers=[AWL.configuration.getInstance().getTurnServerURL()]}else{O.iceServers=[]}}}c=new AWL.webrtc.PeerConnection();c.evtRemoteStream.attach(k);c.evtLocalCandidates.attach(p);c.evtLocalDescription.attach(z);if(navigator.webkitGetUserMedia){c.evtReattachingStream.attach(t)}c.init({rtcConfiguration:O,constraints:{optional:[{DtlsSrtpKeyAgreement:true}]}});c.addStream(_stream);var P={sdp:M,type:"offer"};c.setRemoteDescription(P,function(Q){AWL.console.error("setRemoteDescriptionErrorHandler: "+Q)},{optional:[{MozDontOfferDataChannel:true}]})}else{if(r!==null){AWL.console.debug("Early Media Answer sent already! Resend same SDP again in answer: \n"+r);AWL.jsonRpc.call(AWL.serviceType,"answerCall",r,J)}else{N=true;AWL.console.debug("Received answerCall but earlyMediaAnswer is not yet sent\n")}}}};return a}();var CONST={AWL_VERSION:"10.1.000-13",AWL_MSG_WEBRTC_NOTSUPPORTED:"AWL_MSG_WEBRTC_NOTSUPPORTED",AWL_MSG_WEBRTC_SUPPORTED:"AWL_MSG_WEBRTC_SUPPORTED",PHONESERVICE:"phoneservice",AGENTSERVICE:"agentservice",RELAYSERVICE:"relayservice",MAX_ALLOWED_CALL_COUNT:3,AWL_MSG_SETCONFIG_SUCCESS:"AWL_MSG_SETCONFIG_SUCCESS",AWL_MSG_SETCONFIG_FAILED:"AWL_MSG_SETCONFIG_FAILED",AWL_MSG_SETDOM_SUCCESS:"AWL_MSG_SETDOM_SUCCESS",AWL_MSG_SETDOM_FAILED:"AWL_MSG_SETDOM_FAILED",AWL_MSG_LOGIN_EMPTYUSERNAME:"AWL_MSG_LOGIN_EMPTYUSERNAME",AWL_MSG_LOGIN_EMPTYPASSWORD:"AWL_MSG_LOGIN_EMPTYPASSWORD",AWL_MSG_LOGIN_GW_NOTCONFIGURED:"AWL_MSG_LOGIN_GW_NOTCONFIGURED",AWL_MSG_LOGIN_SUCCESS:"AWL_MSG_LOGIN_SUCCESS",AWL_MSG_LOGIN_FAILED:"AWL_MSG_LOGIN_FAILED",AWL_MSG_LINK_ISSUE_DETECTED:"AWL_MSG_LINK_ISSUE_DETECTED",AWL_MSG_DUPLICATE_LOGIN:"AWL_MSG_DUPLICATE_LOGIN",AWL_MSG_LOGGEDOUT:"AWL_MSG_LOGGEDOUT",AWL_MSG_LOGIN_WEBSOCKET_FAILURE:"AWL_MSG_LOGIN_WEBSOCKET_FAILURE",AWL_MSG_DEVICEACCESS_FAILURE:"AWL_MSG_DEVICEACCESS_FAILURE",AWL_MSG_CALL_IDLE:"AWL_MSG_CALL_IDLE",AWL_MSG_CALL_PROGRESSING:"AWL_MSG_CALL_PROGRESSING",AWL_MSG_CALL_CONNECTED:"AWL_MSG_CALL_CONNECTED",AWL_MSG_CALL_DISCONNECTED:"AWL_MSG_CALL_DISCONNECTED",AWL_MSG_CALL_FAILED:"AWL_MSG_CALL_FAILED",AWL_MSG_CALL_INCOMING:"AWL_MSG_CALL_INCOMING",AWL_MSG_CALL_RINGING:"AWL_MSG_CALL_RINGING",AWL_MSG_CALL_HELD:"AWL_MSG_CALL_HELD",AWL_MSG_CALL_FAREND_UPDATE:"AWL_MSG_CALL_FAREND_UPDATE",AWL_MSG_CALL_MAXCAP_REACHED:"AWL_MSG_CALL_MAXCAP_REACHED",AWL_MSG_CALL_TRANSFER_FAILED:"AWL_MSG_CALL_TRANSFER_FAILED",AWL_MSG_LOOPBACK_CONN_SUCCESSFULL:"AWL_MSG_LOOPBACK_CONN_SUCCESSFULL",AWL_MSG_LOOPBACK_CONN_FAILED:"AWL_MSG_LOOPBACK_CONN_FAILED",AWL_MSG_LOOPBACK_CONN_LINK_ISSUE:"AWL_MSG_LOOPBACK_CONN_LINK_ISSUE",AWL_MSG_LOOPBACK_CONN_CLOSED:"AWL_MSG_LOOPBACK_CONN_CLOSED",AWL_MSG_LOOPBACK_STATS_FAILURE:"AWL_MSG_LOOPBACK_STATS_FAILURE"};AWL.namespace("client");AWL.client=(function(){var a;var b=function(){var B=this;var D=AWL.configuration.getInstance();var E=AWL.registration.getInstance();var o=AWL.callmanager.getInstance();var H=AWL.loopBack.getInstance();var g=AWL.callmanager_9_1version.getInstance();AWL.sdkLog.disableLogging();AWL.clientLog.disableLogging();this.init=function(){AWL.serviceType=CONST.PHONESERVICE;AWL.onConfigChange=new AWL.callBack();AWL.onRegistrationStateChange=new AWL.callBack();AWL.onNewIncomingCall=new AWL.callBack();AWL.onCallStateChange=new AWL.callBack();AWL.onCallTerminate=new AWL.callBack();AWL.onLoopBackNotification=new AWL.callBack();AWL.onDeviceListRequested=new AWL.callBack();AWL.onVideoStreamsAvailable=new AWL.callBack();AWL.onAudioStreamsAvailable=new AWL.callBack()};var I=function(){AWL.clientAPIConsole.log("\nClient Api :: isWebRTCSupported");if(!AWL.webrtc.exists){return CONST.AWL_MSG_WEBRTC_NOTSUPPORTED}return CONST.AWL_MSG_WEBRTC_SUPPORTED};var w=function(){AWL.clientAPIConsole.log("\nClient Api :: sdkVersion"+CONST.AWL_VERSION);return CONST.AWL_VERSION};var p=function(){AWL.clientAPIConsole.log("\nClient Api :: Logging Enabled");AWL.sdkLog.enableLogging();AWL.clientLog.enableLogging()};var z=function(){AWL.clientAPIConsole.log("\nClient Api :: Logging Disabled");AWL.sdkLog.disableLogging();AWL.clientLog.disableLogging()};var k=function(P){AWL.clientAPIConsole.log("\nClient Api :: Setting Log Object");AWL.console=P;AWL.clientAPIConsole=P};var h=function(Q,S,R,P){AWL.clientAPIConsole.log("\nClient Api :: setConfiguration");B.init();if((typeof(S)==="undefined")||(typeof(R)==="undefined")||(typeof(P)==="undefined")){if(typeof(S)==="undefined"){AWL.clientAPIConsole.error("\nClient Api :: setConfiguration - Mandatory config change callback missing");AWL.onConfigChange.attach(onconfigStateChange)}else{AWL.onConfigChange.attach(S)}if(typeof(R)==="undefined"){AWL.clientAPIConsole.error("\nClient Api :: setConfiguration - Mandatory registration state change callback missing");AWL.onRegistrationStateChange.attach(onRegistrationStateChange)}else{AWL.onRegistrationStateChange.attach(R)}if(typeof(P)==="undefined"){AWL.clientAPIConsole.error("\nClient Api :: setConfiguration - Mandatory call state change callback missing");AWL.onNewIncomingCall.attach(onCallListener);AWL.onCallStateChange.attach(onCallListener);AWL.onCallTerminate.attach(onCallListener);AWL.onLoopBackNotification.attach(onCallListener);if(AWL.inUse_Version!=="9.1"){AWL.onVideoStreamsAvailable.attach(onCallListener);AWL.onAudioStreamsAvailable.attach(onCallListener)}}else{AWL.onNewIncomingCall.attach(P.onNewIncomingCall);AWL.onCallStateChange.attach(P.onCallStateChange);AWL.onCallTerminate.attach(P.onCallTerminate);AWL.onLoopBackNotification.attach(P.onLoopBackNotification);if(typeof(P.onVideoStreamsAvailable)!=="undefined"){if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: SDK Support for Video Stream Available Event Notifications is not available in 9.1 version")}else{AWL.onVideoStreamsAvailable.attach(P.onVideoStreamsAvailable)}}if(typeof(P.onAudioStreamsAvailable)!=="undefined"){if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: SDK Support for Audio Stream Available Event Notifications is not available in 9.1 version")}else{AWL.onAudioStreamsAvailable.attach(P.onAudioStreamsAvailable)}}}}else{AWL.onConfigChange.attach(S);AWL.onRegistrationStateChange.attach(R);AWL.onNewIncomingCall.attach(P.onNewIncomingCall);AWL.onCallStateChange.attach(P.onCallStateChange);AWL.onCallTerminate.attach(P.onCallTerminate);AWL.onLoopBackNotification.attach(P.onLoopBackNotification);if(typeof(P.onVideoStreamsAvailable)!=="undefined"){if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: SDK Support for Video Stream Available Event Notifications is not available in 9.1 version")}else{AWL.onVideoStreamsAvailable.attach(P.onVideoStreamsAvailable)}}if(typeof(P.onAudioStreamsAvailable)!=="undefined"){if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: SDK Support for Audio Stream Available Event Notifications is not available in 9.1 version")}else{AWL.onAudioStreamsAvailable.attach(P.onAudioStreamsAvailable)}}AWL.clientAPIConsole.debug("\nClient Api :: client callbacks registered - successfully")}if(D.setConfiguration(Q)===false){AWL.clientAPIConsole.error("\nClient Api :: setConfiguration failed")}else{AWL.clientAPIConsole.debug("\nClient Api :: setConfiguration success")}};var c=function(P){if(D.setDomElements(P)===false){AWL.clientAPIConsole.error("\nClient Api :: setDomElements - FAILED")}else{AWL.clientAPIConsole.log("\nClient Api :: setDomElements - SUCCESS")}};var M=function(P){AWL.clientAPIConsole.log("\nClient Api :: getDeviceList");if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: getDeviceList - Device enumeration is not supported in 9.1 version");return}if(typeof(P)==="undefined"){AWL.clientAPIConsole.error("\nClient Api :: getDeviceList - Mandatory deviceListRequested callback missing");AWL.onDeviceListRequested.attach(onDeviceListRequested)}else{AWL.onDeviceListRequested.attach(P)}AWL.devicemanager.getInstance().getDeviceInfo()};var f=function(P){AWL.clientAPIConsole.log("\nClient Api :: setDeviceIds ");if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: getDeviceList - Device enumeration is not supported in 9.1 version");return}if(D.setDeviceIds(P)===false){AWL.clientAPIConsole.error("\nClient Api :: setDeviceIds - FAILED")}else{AWL.clientAPIConsole.log("\nClient Api :: setDeviceIds - SUCCESS")}};var e=function(S,P,R,Q){AWL.clientAPIConsole.info("\nClient Api :: logIn"+R);if(I()===CONST.AWL_MSG_WEBRTC_SUPPORTED){AWL.totalCalls=0;if(typeof(R)==="undefined"){R=false}if(typeof(Q)==="undefined"){Q=false}if(E.logIn(S,P,R,Q)){AWL.clientAPIConsole.error("\nClient Api :: logIn failed - invalid userName or password or GW IP set")}}else{AWL.clientAPIConsole.error("\nClient Api :: logIn failed - as Web RTC is not supported in this browser")}};var l=function(){AWL.clientAPIConsole.info("\nClient Api :: logOut");E.logOut()};var L=function(){var P=E.isloggedIn();AWL.clientAPIConsole.debug("\nClient Api :: _isloggedIn = "+P);return P};var C=function(P,Q){AWL.clientAPIConsole.debug("\nClient Api :: makeCall");if(D.getConfiguration().serviceType!==CONST.RELAYSERVICE){if(AWL.inUse_Version==="9.1"){return(g.makeCall(P,Q))}else{return(o.makeCall(P,Q))}}else{AWL.clientAPIConsole.error("\nClient Api :: makeCall denied in relay service")}};var N=function(R,P,Q){AWL.clientAPIConsole.debug("\nClient Api :: transferCall");o.transferCall(R,P,Q)};var x=function(P){AWL.clientAPIConsole.debug("\nClient Api :: answerCall");if(AWL.inUse_Version==="9.1"){g.answerCall(P)}else{o.answerCall(P)}};var O=function(P){AWL.clientAPIConsole.debug("\nClient Api :: rejectCall");if(AWL.inUse_Version==="9.1"){g.rejectCall(P)}else{o.rejectCall(P)}};var d=function(P){AWL.clientAPIConsole.debug("\nClient Api :: dropCall");if(AWL.inUse_Version==="9.1"){g.dropCall(P)}else{o.dropCall(P)}};var A=function(P){AWL.clientAPIConsole.debug("\nClient Api :: cancelCall");if(AWL.inUse_Version==="9.1"){g.cancelCall(P)}else{o.cancelCall(P)}};var K=function(P){AWL.clientAPIConsole.debug("\nClient Api :: doHold");if(AWL.inUse_Version==="9.1"){g.doHold(P)}else{o.doHold(P)}};var F=function(P){AWL.clientAPIConsole.debug("\nClient Api :: doUnHold");if(AWL.inUse_Version==="9.1"){g.doUnHold(P)}else{o.doUnHold(P)}};var y=function(P){AWL.clientAPIConsole.debug("\nClient Api :: doMute");if(AWL.inUse_Version==="9.1"){return(g.doMute(P))}else{return(o.doMute(P))}};var s=function(P){AWL.clientAPIConsole.debug("\nClient Api :: doUnMute");if(AWL.inUse_Version==="9.1"){return(g.doUnMute(P))}else{return(o.doUnMute(P))}};var t=function(P){AWL.clientAPIConsole.debug("\nClient Api :: pauseVideo");if(AWL.inUse_Version==="9.1"){return(g.pauseVideo())}else{return(o.pauseVideo(P))}};var q=function(P){AWL.clientAPIConsole.debug("\nClient Api :: playVideo");if(AWL.inUse_Version==="9.1"){return(g.playVideo())}else{return(o.playVideo(P))}};var r=function(P,Q){AWL.clientAPIConsole.debug("\nClient Api :: sendDTMF");if(AWL.inUse_Version==="9.1"){g.sendDTMF(P,Q)}else{o.sendDTMF(P,Q)}};var j=function(P){AWL.clientAPIConsole.debug("\nClient Api :: getStats");return o.getStats(P)};var G=function(P){AWL.clientAPIConsole.debug("\nClient Api :: addVideo");o.addVideo(P)};var n=function(P){AWL.clientAPIConsole.debug("\nClient Api :: removeVideo");o.removeVideo(P)};var u=function(){AWL.clientAPIConsole.debug("Client Api :: createLoopBackConnection");if(D.getConfiguration().serviceType==="relay"){var P=false;if(D.getDomElements().relayAudioTagId!==""){if(document.getElementById(D.getDomElements().relayAudioTagId)===null){AWL.clientAPIConsole.error("Client Api :: createLoopBackConnection - invalid audio tag id");return}}else{AWL.clientAPIConsole.error("Client Api :: createLoopBackConnection - Mandate audio tag id missing");return}if(E.isloggedIn()){AWL.clientAPIConsole.debug("Client Api :: creating loop back connection");H.createLoopBackConnection()}else{AWL.clientAPIConsole.debug("Client Api :: createLoopBackConnection not allowed as user is not logged in yet")}}else{AWL.clientAPIConsole.error("Client Api :: createLoopBackConnection not allowed as service type used is not relay")}};var v=function(){AWL.clientAPIConsole.debug("Client Api :: endLoopBackConnection");H.endLoopBackConnection()};var m=function(U,T,R,Q){if(AWL.inUse_Version==="9.1"){AWL.clientAPIConsole.error("\nClient Api :: setMediaStream : No support in 9.1 version");return}if(typeof(U)!=="undefined"&&typeof(T)!=="undefined"&&typeof(R)!=="undefined"&&typeof(Q)!=="undefined"){if(typeof(AWL.callMap[R])!=="undefined"&&AWL.callMap[R].getCallState()==="AWL_MSG_CALL_CONNECTED"){AWL.clientAPIConsole.debug("Client Api :: setMediaStream");var S=AWL.callMap[R];if(!S.isDomElementSet()){AWL.clientAPIConsole.log("Client Api :: setMediaStream : Configuring the Dom Elements");var P=document.getElementById(U)||U;AWL.webrtc.mediaSetStream(P,T);S.setDomElementForMedia(P,Q)}else{AWL.clientAPIConsole.log("Client Api :: setMediaStream : Dom Elements are Configured Previously")}}}else{AWL.clientAPIConsole.error("Client Api :: setMediaStream : Invalid arguments")}};var J=function(){AWL.clientAPIConsole.debug("Client Api :: getLoopBackStats");H.getLoopBackStats();return H.collectLoopBackStats()};return{isWebRTCSupported:I,getSdkVersion:w,setConfiguration:h,setLogObject:k,enableLogging:p,disableLogging:z,setDomElements:c,logIn:e,logOut:l,isloggedIn:L,makeCall:C,answerCall:x,rejectCall:O,dropCall:d,cancelCall:A,doHold:K,doUnHold:F,doMute:y,doUnMute:s,pauseVideo:t,playVideo:q,sendDTMF:r,transferCall:N,getStats:j,addVideo:G,removeVideo:n,createLoopBackConnection:u,endLoopBackConnection:v,getLoopBackStats:J,setDeviceIds:f,getDeviceList:M,setMediaStream:m}};return b})();